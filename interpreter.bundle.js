"use strict";(self.webpackChunkracket_online_ide=self.webpackChunkracket_online_ide||[]).push([[465],{223:(e,t,n)=>{n.d(t,{q:()=>o});var s=n(1),r=n(34),i=n(870),a=n(432);class o{constructor(e){this.global=new s.x,this.map=new Map,this.parentEnv=e}set(e,t){this.map.set(e,t)}get(e,t){const n=this.map.get(e);if(n)return n;if(this.parentEnv)return this.parentEnv.get(e,t);if(!i.L.primitives.blackList.includes(e)&&this.global.primitiveEnvironment.map.has(e))return this.global.primitiveEnvironment.get(e,t);throw new a.ME((0,r.eX)(e),t)}delete(e){this.map.delete(e)}copy(){const e=new o;for(const t of this.map)e.set(t[0],t[1]);let t=this;for(;t.parentEnv;){t=t.parentEnv;for(const[n,s]of t.map)e.map.has(n)||e.set(n,s)}return e}has(e){return this.map.has(e)||this.parentEnv&&this.parentEnv.has(e)||!i.L.primitives.blackList.includes(e)&&this.global.primitiveEnvironment.map.has(e)}}},625:(e,t,n)=>{var s;n.d(t,{j:()=>r,Z:()=>s}),function(e){e.And="and",e.CheckError="check-error",e.CheckExpect="check-expect",e.CheckMemberOf="check-member-of",e.CheckRandom="check-random",e.CheckRange="check-range",e.CheckSatisfied="check-satisfied",e.CheckWithin="check-within",e.Cond="cond",e.Define="define",e.DefineStruct="define-struct",e.Else="else",e.If="if",e.Lambda="lambda",e.Letrec="letrec",e.Letstar="let*",e.Let="let",e.Local="local",e.Or="or",e.Quasiquote="quasiquote",e.Quote="quote",e.Require="require",e.Unquote="unquote"}(s||(s={}));const r=[];for(const e in s)r.push(s.valueOf()[e])},484:(e,t,n)=>{n.d(t,{s:()=>c,x:()=>s});var s,r=n(34),i=n(1),a=n(870),o=n(432);class c{constructor(e=!1){this.global=new i.x,this.variables=new Map,this.parentScope=e}set(e,t){this.variables.set(e,t)}get(e,t,n){const s=this.variables.get(e)||this.parentScope&&this.parentScope.get(e,t,n)||!a.L.primitives.blackList.includes(e)&&(a.L.primitives.relaxedConditions.includes(e)&&this.global.primitiveRelaxedScope.variables.has(e)&&this.global.primitiveRelaxedScope.get(e,t,n)||this.global.primitiveScope.variables.has(e)&&this.global.primitiveScope.get(e,t,n));if(!s)throw t?new o.ME((0,r.In)(e),n):new o.ME((0,r.yu)(e),n);return s}has(e){return this.variables.has(e)||this.parentScope&&this.parentScope.has(e)||!a.L.primitives.blackList.includes(e)&&this.global.primitiveScope.variables.has(e)}}!function(e){e.Data="DATA",e.PrimitiveFunction="PRIMITIVE_FUNCTION",e.StructureType="STRUCTURE_TYPE",e.UserDefinedFunction="USER_DEFINED_FUNCTION"}(s||(s={}))},226:(e,t,n)=>{n.d(t,{B:()=>s,D:()=>r});const s=r(0,0,0,0);function r(e,t,n,s){return{startLineno:e,startColno:t,endLineno:n,endColno:s}}},432:(e,t,n)=>{n.d(t,{ME:()=>s,mf:()=>r,ty:()=>i});class s extends Error{constructor(e,t){super(e),this.msg=e,this.sourceSpan=t}}function r(e,t=[],n=[]){return{output:e,errors:t,tests:n}}function i(e,t,n){return{passed:e,errMsg:t,sourceSpan:n}}},34:(e,t,n)=>{n.d(t,{l:()=>a,Iy:()=>o,Cq:()=>c,KW:()=>u,XM:()=>l,yG:()=>h,bB:()=>p,R0:()=>d,v_:()=>w,$h:()=>m,z3:()=>f,gD:()=>g,NS:()=>v,C0:()=>y,He:()=>x,$Z:()=>E,JY:()=>S,ll:()=>b,yQ:()=>T,ON:()=>k,Ax:()=>C,d:()=>N,B:()=>M,fN:()=>A,Mi:()=>$,Kl:()=>P,bU:()=>B,eJ:()=>F,AC:()=>D,YT:()=>R,XK:()=>q,_m:()=>_,WY:()=>L,vL:()=>H,n4:()=>W,a1:()=>Z,F6:()=>I,R5:()=>O,y5:()=>K,HQ:()=>U,Lx:()=>G,Qe:()=>z,Pd:()=>X,tw:()=>V,SY:()=>Y,s5:()=>Q,Gl:()=>J,Ci:()=>j,sH:()=>te,QF:()=>ee,OP:()=>se,Eh:()=>ne,zs:()=>re,jf:()=>ie,Gb:()=>ae,Qb:()=>oe,zO:()=>ce,hd:()=>ue,hp:()=>le,SE:()=>he,gn:()=>pe,QM:()=>de,Lf:()=>we,_M:()=>me,xL:()=>fe,p7:()=>ge,R6:()=>ve,uC:()=>ye,wS:()=>xe,vN:()=>Ee,zv:()=>Se,ne:()=>be,WA:()=>Te,mS:()=>Ne,rO:()=>ke,A6:()=>Ce,qR:()=>Ae,C_:()=>$e,An:()=>Me,fW:()=>Pe,cN:()=>Fe,bf:()=>Be,vV:()=>De,dx:()=>Re,JC:()=>qe,nT:()=>_e,yu:()=>Le,In:()=>He,eX:()=>We,te:()=>Ze,R9:()=>Ie,NJ:()=>Oe,n3:()=>Ke,u:()=>Ue,hC:()=>Ge,ss:()=>Xe});var s=n(326),r=n(813);function i(e){if("string"==typeof e)return e.toString();if(!(0,s.F)(e))return"a part";switch(e.token.type){case r.i.True:case r.i.False:return"a boolean";case r.i.Integer:case r.i.Rational:case r.i.Decimal:return"a number";case r.i.Character:return"a character";case r.i.String:return"a string";case r.i.Keyword:return"a keyword";case r.i.Placeholder:return"a template";default:return"something else"}}const a=(e,t)=>`Actual value ${e} differs from ${t}, the expected value.`,o=e=>`${e} cannot compare functions.`,c=(e,t,n)=>`${e} cannot compare inexact numbers. Try (check-within ${t} ${n} range).`,u=e=>`check-error expected an error, but instead received the value ${e}`,l=e=>`check-error: expects a string (the expected error message) for the second argument. Given ${e}`,h=(e,t,n)=>`Actual value ${e} is not between ${t} and ${n}, inclusive.`,p=(e,t)=>`Actual value ${e} differs from all given members in ${t.join(" ")}`,d=(e,t)=>`Actual value ${t} does not satisfy ${e}.`,w=(e,t,n)=>`Actual value ${e} is not within ${n} of expected value ${t}`,m=(e,t)=>`check-satisfied encountered an error instead of the expected kind of value, "${e}".\n  :: ${e} [as predicate in check-satisfied]: is expected to return a boolean, but it returned ${t}`,f=e=>`${e}: found a test that is not at the top level`,g=(e,t)=>`check-error encountered the following error instead of the expected ${e}\n  :: ${t}`,v="cond: all question results were false",y="cond: found an else clause that isn't the last clause in its cond expression",x=e=>{if(!e)return"cond: expected a clause after cond, but nothing's there";if(!(0,s.MW)(e))return`cond: expected a clause with a question and an answer, but found ${i(e)}`;switch(e.subSExprs.length){case 0:return"cond: expected a clause with a question and an answer, but found an empty part";case 1:return"cond: expected a clause with a question and an answer, but found a clause with only one part";default:return`cond: expected a clause with a question and an answer, but found a clause with ${e.subSExprs.length} parts`}},E=e=>`define: found a variable that is used more than once: ${e}`,S="define: expected at least one variable after the function name, but found none",b=e=>`define: expected an expression after the variable name ${e}, but nothing's there`,T="define: expected an expression for the function body, but nothing's there",k=e=>"define: expected the name of the function, but "+(e?`found ${i(e)}`:"nothing's there"),N=e=>"define: expected a variable name, or a function name and its variables (in parentheses), but "+(e?`found ${i(e)}`:"nothing's there"),C=e=>`define: expected a variable, but found ${i(e)}`,A=(e,t)=>`define: expected only one expression after the variable name ${e}, but found ${t} extra part${t>1?"s":""}`,$=e=>`define: expected only one expression for the function body, but found ${e} extra part${e>1?"s":""}`,M=e=>`${e}: this name was defined previously and cannot be re-defined`,P=e=>`define-struct: found a field name that is used more than once: ${e}`,F=e=>`define-struct: expected a field name, but found ${i(e)}`,B=e=>"define-struct: expected at least one field name (in parentheses) after the structure name, but "+(e?`found ${i(e)}`:"nothing's there"),D=e=>"define-struct: expected the structure name after define-struct, but "+(e?`found ${i(e)}`:"nothing's there"),R=e=>`define-struct: expected nothing after the field names, but found ${e} extra part${e>1?"s":""}`,q=e=>`${e}: expected a finished expression, but found a template`,_="else: not allowed here, because this is not a question in a clause",L=(e,t,n)=>t<n?0===t?`${e}: expects no argument, but found ${n}`:`${e}: expects only ${t} argument${t>1?"s":""}, but found ${n}`:`${e}: expects ${t} argument${t>1?"s":""}, but found ${0===n?"none":`only ${n}`}`,H=e=>`${e}: complex numbers are not supported`,W="/: division by zero",Z=(e,t,n)=>`${e}: expects at least ${t} argument${t>1?"s":""}, but found ${n>=2?n:1===n?"only 1":"none"}`,I=(e,t,n,s)=>`${e}: expects a${t.match(/^[aeiou]/)?"n":""} ${t} as ${function(e){const t=e%10,n=e%100;return 1==t&&11!=n?e+"st":2==t&&12!=n?e+"nd":3==t&&13!=n?e+"rd":e+"th"}(n+1)} argument, given ${s}`,O=(e,t,n)=>`${e}: expects a${t.match(/^[aeiou]/)?"n":""} ${t}, given ${n}`,K=e=>"function call: expected a function after the open parenthesis, but "+(e?`found ${i(e)}`:"nothing's there"),U=(e,t,n)=>`${e}: contract violation\n  expected: ${t}\n  received: ${n}`,G=(e,t,n)=>`${e}: expected a boolean from ${t} (the function given to ${e}), but received ${n}`,X=e=>`${e}: expects (at least) one list argument, given none`,z=(e,t,n,s)=>`${e}: all lists must have same size\n  first list length: ${t}\n  other list length: ${n}\n  procedure: ${s}`,V=e=>0===e?"if: expected a question and two answers, but nothing's there":1===e?"if: expected a question and two answers, but found only 1 part":2===e?"if: expected a question and two answers, but found only 2 parts":`if: expected a question and two answers, but found ${e} parts`,Y=e=>`lambda: found a variable that is used more than once: ${e}`,Q=e=>0===e?"lambda: expected an expression for the function body, but nothing's there":`lambda: expected only one expression for the function body, but found ${e} extra parts`,J=(e=null)=>"lambda: expected (lambda (variable more-variable ...) expression), but "+(e?`found ${i(e)}`:"nothing's there"),j=e=>`lambda: expected a variable, but found ${i(e)}`,ee="lambda: expected (lambda (variable more-variable ...) expression), but found no variables",te="lambda: found a lambda that is not a function definition",ne=e=>`local: expected a definition, but found ${i(e)}`,se=(e=null)=>"local: expected at least one definition (in square brackets) after local, but "+(e?`found ${i(e)}`:"nothing's there"),re="local: expected an expression after the local definitions, but nothing's there",ie=e=>`local: expected only one expression after the local definitions, but found ${e} extra part${e>1?"s":""}`,ae=e=>`local: ${e} was defined locally more than once`,oe=(e,t)=>`${e}: expected an expression after the name ${t}, but nothing's there`,ce=(e,t,n)=>`${e}: expected only one expression after the name ${t}, but found ${n} extra part${n>1?"s":""}`,ue=(e,t)=>`${e}: expected a variable for the binding, but found ${i(t)}`,le=(e,t=null)=>`${e}: expected at least one binding (in parentheses) after ${e}, but ${t?`found ${i(t)}`:"nothing's there"}`,he=e=>`${e}: expected an expression after the bindings, but nothing's there`,pe=(e,t)=>`${e}: expected an expression after the bindings, but found ${t} extra part${t>1?"s":""}`,de=(e,t)=>`${e}: expected a binding with a variable and an expression, but found ${i(t)}`,we="quote: expected an expression after quote, but nothing's there",me=e=>`quote: expected only one expression after quote, but found ${e} extra part${e>1?"s":""}`,fe=e=>`quote: expected the name of a symbol or () after the quote, but found ${i(e)}`,ge=(e,t)=>0===e?"require: expected a module name after `require', but found nothing":e>1?`require: expected a single module name after \`require', but found ${e} parts`:`require: expected a module name after \`require', found ${i(t)}`,ve=e=>`require: module not found: ${e}`,ye="require: found a module require that is not at the top level",xe=e=>`read-syntax: bad character constant \`${e}\``,Ee=e=>`read-syntax: bad syntax \`${e}\``,Se=e=>`read-syntax: division by zero in \`${e}\``,be="read-syntax: end-of-file following `\\` in symbol",Te="read-syntax: expected a character after `#\\`",ke=e=>"("===e?"read-syntax: expected a `)` to close preceding `(`":"["===e?"read-syntax: expected a `]` to close preceding `[`":"read-syntax: expected a `}` to close preceding `{`",Ne="read-syntax: end of file in `#|` comment",Ce="read-syntax: end-of-file following `|` in symbol",Ae='read-syntax: expected a closing `"`',$e="read-syntax: expected a commented-out element for `#;`, but found end-of-file",Me=(e,t)=>"("===e?`read-syntax: expected \`)\` to close preceding \`(\`, found instead \`${t}\``:"["===e?`read-syntax: expected \`]\` to close preceding \`[\`, found instead \`${t}\``:`read-syntax: expected \`}\` to close preceding \`{\`, found instead \`${t}\``,Pe=e=>`read-syntax: expected an element for quoting "'", but found ${e}`,Fe=e=>`read-syntax: expected an element for unquoting "'", but found ${e}`,Be=e=>`read-syntax: illegal use of \`${e}\``,De="read-syntax: nested quotes are not supported",Re=e=>`read-syntax: unexpected \`${e}\``,qe=e=>`read-syntax: unknown escape sequence \`\\${e}\` in string`,_e="runtime: maximum call stack size exceeded",Le=e=>`${e}: this function is undefined`,He=e=>`${e}: this variable is not defined`,We=e=>`${e} is used here before its definition`,Ze=e=>`${e}: expected an open parenthesis before ${e}, but found none`,Ie=(e,t)=>`${e}: misuse of a ${t} or ${e}, not under a quasiquoting backquote`,Oe=e=>`${e}: misuse of ${e} within a quas`,Ke=e=>`${e}: expected a function call, but there is no open parenthesis before this function`,Ue=e=>`${e}: found a definition that is not at the top level`,Ge=(e,t)=>`${e}: question result is not true or false: ${t}`,Xe=e=>`${e}: structure type; do you mean make-${e}`},1:(e,t,n)=>{n.d(t,{x:()=>Zt});var s=n(794),r=n(359),i=n(34);class a{static fromDecimal(e){const t=10**e.toString().length;return new s.Af(BigInt(e*t),BigInt(t))}static toExact(e){return new s.pv(e.numerator,e.denominator)}static toInexact(e){return new s.Af(e.numerator,e.denominator)}static make(e,t,n=1n){return e?new s.pv(t,n):new s.Af(t,n)}static ceil(e){return 1n===e.denominator?e:e.isNegative()?a.make((0,s.cU)(e),e.numerator/e.denominator):a.make((0,s.cU)(e),e.numerator/e.denominator+1n)}static floor(e){return 1n===e.denominator?e:e.isNegative()?a.make((0,s.cU)(e),e.numerator/e.denominator-1n):a.make((0,s.cU)(e),e.numerator/e.denominator)}static add(e,t){const n=(0,s.cU)(e)&&(0,s.cU)(t),r=e.numerator*t.denominator+e.denominator*t.numerator,i=e.denominator*t.denominator;return a.make(n,r,i)}static div(e,t){const n=(0,s.cU)(e)&&(0,s.cU)(t),r=e.numerator*t.denominator,i=e.denominator*t.numerator;return a.make(n,r,i)}static mul(e,t){const n=(0,s.cU)(e)&&(0,s.cU)(t),r=e.numerator*t.numerator,i=e.denominator*t.denominator;return a.make(n,r,i)}static sub(e,t){const n=(0,s.cU)(e)&&(0,s.cU)(t),r=e.numerator*t.denominator-e.denominator*t.numerator,i=e.denominator*t.denominator;return a.make(n,r,i)}static pow(e,t){if(t.isZero())return new s.pv(1n);if(e.isZero())return new s.pv(0n);if(e.isNegative()&&1n!==t.denominator)throw"illegal state: complex numbers not supported";{let n,r,i;if(t.isNegative()?(n=t.negate(),r=e.denominator**n.numerator,i=e.numerator**n.numerator):(n=t,r=e.numerator**n.numerator,i=e.denominator**n.numerator),a.perfectPower(r,t.denominator)&&a.perfectPower(i,t.denominator)){const n=(0,s.cU)(e)&&(0,s.cU)(t);return a.make(n,a.iroot(r,t.denominator),a.iroot(i,t.denominator))}return a.fromDecimal(Number(r)**(1/Number(n.denominator))/Number(i)**(1/Number(n.denominator)))}}static perfectPower(e,t){return a.iroot(e,t)**t===e}static iroot(e,t){let n=e+1n;const s=t-1n;let r=e;for(;r<n;)n=r,r=(r*s+e/r**s)/t;return n}}var o=n(819),c=n(432);const u=new s.Af(6121026514868073n,2251799813685248n),l=new s.Af(884279719003555n,281474976710656n);class h extends s.em{constructor(){super("*",{minArity:2,relaxedMinArity:0})}getType(e){return new r.B5(new Array(e).fill(new r.sw),new r.sw)}call(e){return e.reduce(((e,t)=>a.mul(e,t)),new s.pv(1n))}}class p extends s.em{constructor(){super("+",{minArity:2,relaxedMinArity:0})}getType(e){return new r.B5(new Array(e).fill(new r.sw),new r.sw)}call(e){return e.reduce(((e,t)=>a.add(e,t)),new s.pv(0n))}}class d extends s.em{constructor(){super("-",{minArity:1})}getType(e){return new r.B5(new Array(e).fill(new r.sw),new r.sw)}call(e){return 1===e.length?e[0].negate():e.slice(1).reduce(((e,t)=>a.sub(e,t)),e[0])}}class w extends s.em{constructor(){super("/",{minArity:2,relaxedMinArity:0})}getType(e){return new r.B5(new Array(e).fill(new r.sw),new r.sw)}call(e,t){if(1===e.length){if(e[0].isZero())throw new c.ME(i.n4,t);return a.div(a.make(!0,1n),e[0])}return e.slice(1).reduce(((e,n)=>{if(n.isZero())throw new c.ME(i.n4,t);return a.div(e,n)}),e[0])}}class m extends s.em{constructor(){super("<",{minArity:1})}getType(e){return new r.B5(new Array(e).fill(new r.hZ),new r.wy)}call(e){for(let t=0;t<e.length-1;t++)if(!(e[t].toDecimal()<e[t+1].toDecimal()))return s.Tg;return s.Xp}}class f extends s.em{constructor(){super("<=",{minArity:1})}getType(e){return new r.B5(new Array(e).fill(new r.hZ),new r.wy)}call(e){for(let t=0;t<e.length-1;t++)if(!(e[t].toDecimal()<=e[t+1].toDecimal()))return s.Tg;return s.Xp}}class g extends s.em{constructor(){super("=",{minArity:1})}getType(e){return new r.B5(new Array(e).fill(new r.sw),new r.wy)}call(e){for(let t=0;t<e.length-1;t++)if(e[t].toDecimal()!==e[t+1].toDecimal())return s.Tg;return s.Xp}}class v extends s.em{constructor(){super(">",{minArity:1})}getType(e){return new r.B5(new Array(e).fill(new r.hZ),new r.wy)}call(e){for(let t=0;t<e.length-1;t++)if(!(e[t].toDecimal()>e[t+1].toDecimal()))return s.Tg;return s.Xp}}class y extends s.em{constructor(){super(">=",{minArity:1})}getType(e){return new r.B5(new Array(e).fill(new r.hZ),new r.wy)}call(e){for(let t=0;t<e.length-1;t++)if(!(e[t].toDecimal()>=e[t+1].toDecimal()))return s.Tg;return s.Xp}}class x extends s.em{constructor(){super("abs")}getType(){return new r.B5([new r.hZ],new r.hZ)}call(e){const t=e[0];return t.isNegative()?t.negate():t}}class E extends s.em{constructor(){super("add1")}getType(){return new r.B5([new r.sw],new r.sw)}call(e){return a.add(e[0],new s.pv(1n))}}class S extends s.em{constructor(){super("ceiling")}getType(){return new r.B5([new r.hZ],new r.Fc)}call(e){return a.ceil(e[0])}}class b extends s.em{constructor(){super("current-seconds")}getType(){return new r.B5([],new r.D9)}call(e){return a.make(!0,BigInt(Math.floor((new Date).getTime()/1e3)))}}class T extends s.em{constructor(){super("denominator")}getType(){return new r.B5([new r.Ee],new r.Fc)}call(e){const t=e[0];return a.make((0,s.cU)(t),t.denominator)}}class k extends s.em{constructor(){super("even?")}getType(){return new r.B5([new r.Fc],new r.wy)}call(e){return(0,s.K_)(e[0].numerator%2n===0n)}}class N extends s.em{constructor(){super("exact->inexact")}getType(){return new r.B5([new r.sw],new r.sw)}call(e){return a.toInexact(e[0])}}class C extends s.em{constructor(){super("exp")}getType(){return new r.B5([new r.sw],new r.sw)}call(e){return a.pow(u,e[0])}}class A extends s.em{constructor(){super("expt")}getType(){return new r.B5([new r.sw,new r.sw],new r.sw)}call(e,t){const n=e[0],s=e[1];if(n.isNegative()&&1n!==s.denominator)throw new c.ME((0,i.vL)(this.name),t);return a.pow(n,s)}}class $ extends s.em{constructor(){super("floor")}getType(){return new r.B5([new r.hZ],new r.Fc)}call(e){return a.floor(e[0])}}class M extends s.em{constructor(){super("inexact->exact")}getType(){return new r.B5([new r.sw],new r.sw)}call(e){return a.toExact(e[0])}}class P extends s.em{constructor(){super("inexact?")}getType(){return new r.B5([new r.sw],new r.wy)}call(e){return(0,s.K_)((0,s.gX)(e[0]))}}class F extends s.em{constructor(){super("integer?")}getType(){return new r.B5([new r.Hs],new r.wy)}call(e){return(0,s.K_)((0,s.Oz)(e[0]))}}class B extends s.em{constructor(){super("max",{minArity:1})}getType(e){return new r.B5(new Array(e).fill(new r.hZ),new r.hZ)}call(e){return e.slice(1).reduce(((e,t)=>e.toDecimal()>t.toDecimal()?e:t),e[0])}}class D extends s.em{constructor(){super("min",{minArity:1})}getType(e){return new r.B5(new Array(e).fill(new r.hZ),new r.hZ)}call(e){return e.slice(1).reduce(((e,t)=>e.toDecimal()<t.toDecimal()?e:t),e[0])}}class R extends s.em{constructor(){super("modulo")}getType(){return new r.B5([new r.Fc,new r.Fc],new r.Fc)}call(e){const t=e[0].numerator,n=e[1].numerator,r=(0,s.cU)(e[0])&&(0,s.cU)(e[1]);return t>0&&n<0?a.make(r,t%n+n):a.make(r,t%n)}}class q extends s.em{constructor(){super("negative?")}getType(){return new r.B5([new r.hZ],new r.wy)}call(e){return(0,s.K_)(e[0].isNegative())}}class _ extends s.em{constructor(){super("number->string")}getType(){return new r.B5([new r.sw],new r.uW)}call(e){return new s.tm(a.toExact(e[0]).stringify())}}class L extends s.em{constructor(e){super(e||"number?")}getType(){return new r.B5([new r.Hs],new r.wy)}call(e){return(0,s.K_)((0,s.LF)(e[0]))}}class H extends s.em{constructor(){super("numerator")}getType(){return new r.B5([new r.Ee],new r.Fc)}call(e){const t=e[0];return a.make((0,s.cU)(t),t.numerator)}}class W extends s.em{constructor(){super("odd?")}getType(){return new r.B5([new r.Fc],new r.wy)}call(e){return(0,s.K_)(e[0].numerator%2n===1n)}}class Z extends s.em{constructor(){super("positive?")}getType(){return new r.B5([new r.hZ],new r.wy)}call(e){return(0,s.K_)(e[0].isPositive())}}class I extends s.em{constructor(){super("quotient")}getType(){return new r.B5([new r.Fc,new r.Fc],new r.Fc)}call(e){const t=e[0],n=e[1],r=(0,s.cU)(t)&&(0,s.cU)(n);return a.make(r,t.numerator/n.numerator)}}class O extends s.em{constructor(){super("random")}getType(){return new r.B5([new r.NL],new r.D9)}call(e){return new s.pv(BigInt(Math.floor(o.i.next()*Number(e[0].numerator))))}}class K extends s.em{constructor(){super("remainder")}getType(){return new r.B5([new r.Fc,new r.Fc],new r.Fc)}call(e){const t=e[0],n=e[1],r=(0,s.cU)(t)&&(0,s.cU)(n);return a.make(r,t.numerator-n.numerator*(t.numerator/n.numerator))}}class U extends s.em{constructor(){super("round")}getType(){return new r.B5([new r.hZ],new r.Fc)}call(e){const t=e[0],n=(0,s.cU)(t);return 2n===t.denominator?t.numerator/2n%2n===0n?a.make(n,t.numerator/t.denominator):a.make(n,t.numerator/t.denominator+1n):t.numerator-t.denominator*(t.numerator/t.denominator)<t.denominator?a.make(n,t.numerator/t.denominator):a.make(n,t.numerator/t.denominator+1n)}}class G extends s.em{constructor(){super("sqr"),this.expt=new s.pv(2n)}getType(){return new r.B5([new r.sw],new r.sw)}call(e){return a.pow(e[0],this.expt)}}class X extends s.em{constructor(){super("sgn")}getType(){return new r.B5([new r.hZ],new r.hE([],[new s.pv(1n),new s.Af(1n),new s.pv(0n),new s.Af(0n),new s.pv(-1n),new s.Af(-1n)]))}call(e){const t=e[0],n=(0,s.cU)(t);return t.isPositive()?a.make(n,1n):t.isNegative()?a.make(n,-1n):a.make(n,0n)}}class z extends s.em{constructor(){super("sqrt"),this.expt=new s.pv(1n,2n)}getType(){return new r.B5([new r.sw],new r.sw)}call(e,t){const n=e[0];if(n.isNegative())throw new c.ME((0,i.vL)(this.name),t);return a.pow(n,this.expt)}}class V extends s.em{constructor(){super("sub1")}getType(){return new r.B5([new r.sw],new r.sw)}call(e){return a.sub(e[0],new s.pv(1n))}}class Y extends s.em{constructor(){super("zero?")}getType(){return new r.B5([new r.sw],new r.wy)}call(e){return(0,s.K_)(e[0].isZero())}}var Q=n(246),J=n(789),j=n(96);class ee extends s.em{assertBooleanType(e,t,n){if(!(0,s.JI)(e))throw new c.ME((0,i.Lx)(super.name,t.stringify(),e.stringify()),n)}assertCorrectType(e,t,n){if((0,r.xW)(e)){if(e.isCompatibleWith(t))return}else if(!(0,s.up)(t)&&e.isSuperTypeOf(t.getType(-1),t))return;throw new c.ME((0,i.HQ)(this.name,e.stringify(),t.stringify()),n)}assertListsLength(e,t,n){const s=e[0].vals.length;for(const r of e.slice(1))if(r.vals.length!==s)throw new c.ME((0,i.Qe)(this.name,s,r.vals.length,t.stringify()),n)}}class te extends ee{constructor(){super("andmap",{minArityWithoutLists:1})}getType(e){return new r.B5([new r.B5(new Array(e-1).fill(new r.Hs),new r.wy),...new Array(e-1).fill(new r.RH)],new r.RH)}call(e,t,n){const r=e[0],i=e.slice(1);this.assertListsLength(i,r,t);for(let e=0;e<i[0].vals.length;e++){const a=r.accept(new j.u(i.map((n=>new J.RD(n.vals[e],t))),n,t));if(this.assertBooleanType(a,r,t),(0,s.h8)(a))return s.Tg}return s.Xp}}class ne extends ee{constructor(){super("apply",{minArity:2})}getType(e){return new r.B5([new r.wj].concat(new Array(e-2).fill(new r.Hs).concat(new r.RH)),new r.Hs)}call(e,t,n){const s=e[0],r=e.slice(1,-1).concat(...e[e.length-1].vals);return s.accept(new j.u(r.map((e=>new J.RD(e,t))),n,t))}}class se extends ee{constructor(){super("argmax")}getType(){return new r.B5([new r.B5([new r.Hs],new r.hZ),new r.RH(1)],new r.Hs)}call(e,t,n){const s=e[0],i=e[1];let a=i.vals[0],o=s.accept(new j.u([new J.RD(a,t)],n,t));this.assertCorrectType(new r.hZ,o,t);for(const e of i.vals.slice(1)){const i=s.accept(new j.u([new J.RD(e,t)],n,t));this.assertCorrectType(new r.hZ,i,t),i.toDecimal()>o.toDecimal()&&(a=e,o=i)}return a}}class re extends ee{constructor(){super("argmin")}getType(){return new r.B5([new r.B5([new r.Hs],new r.hZ),new r.RH(1)],new r.Hs)}call(e,t,n){const s=e[0],i=e[1];let a=i.vals[0],o=s.accept(new j.u([new J.RD(a,t)],n,t));this.assertCorrectType(new r.hZ,o,t);for(const e of i.vals.slice(1)){const i=s.accept(new j.u([new J.RD(e,t)],n,t));this.assertCorrectType(new r.hZ,i,t),i.toDecimal()>o.toDecimal()&&(a=e,o=i)}return a}}class ie extends ee{constructor(){super("build-list")}getType(){return new r.B5([new r.D9,new r.B5([new r.D9],new r.Hs)],new r.RH)}call(e,t,n){const r=e[1],i=[];for(let s=0n;s<e[0].numerator;s++){const e=new j.u([new J.RD(a.make(!0,s),t)],n,t);i.push(r.accept(e))}return new s.zG(i)}}class ae extends ee{constructor(){super("compose")}getType(e){return new r.B5(new Array(Math.max(1,e)).fill(new r.wj),new r.wj)}call(e,t,n){return 1===e.length?e[0]:new s.BC(...e.reverse())}}class oe extends ee{constructor(){super("filter")}getType(){return new r.B5([new r.B5([new r.Hs],new r.wy),new r.RH],new r.RH)}call(e,t,n){const r=e[0],i=e[1],a=[];for(const e of i.vals){const i=r.accept(new j.u([new J.RD(e,t)],n,t));this.assertBooleanType(i,r,t),(0,s.Zb)(i)&&a.push(e)}return new s.zG(a)}}class ce extends ee{constructor(){super("foldl",{minArityWithoutLists:2})}getType(e){return new r.B5([new r.B5(new Array(e-1).fill(new r.Hs),new r.Hs),new r.Hs,...new Array(e-2).fill(new r.RH)],new r.Hs)}call(e,t,n){const s=e[0],r=e[1],i=e.slice(2);this.assertListsLength(i,s,t);let a=r;for(let e=0;e<i[0].vals.length;e++)a=s.accept(new j.u(i.map((n=>new J.RD(n.vals[e],t))).concat([new J.RD(a,t)]),n,t));return a}}class ue extends ee{constructor(){super("foldr",{minArityWithoutLists:2})}getType(e){return new r.B5([new r.B5(new Array(e-1).fill(new r.Hs),new r.Hs),new r.Hs,...new Array(e-2).fill(new r.RH)],new r.Hs)}call(e,t,n){const s=e[0],r=e[1],i=e.slice(2);this.assertListsLength(i,s,t);let a=r;for(let e=i[0].vals.length-1;e>=0;e--)a=s.accept(new j.u(i.map((n=>new J.RD(n.vals[e],t))).concat([new J.RD(a,t)]),n,t));return a}}class le extends ee{constructor(){super("map",{minArityWithoutLists:1})}getType(e){return new r.B5([new r.B5(new Array(e-1).fill(new r.Hs),new r.Hs),...new Array(e-1).fill(new r.RH)],new r.RH)}call(e,t,n){const r=e[0],i=e.slice(1);this.assertListsLength(i,r,t);const a=[];for(let e=0;e<i[0].vals.length;e++)a.push(r.accept(new j.u(i.map((n=>new J.RD(n.vals[e],t))),n,t)));return new s.zG(a)}}class he extends ee{constructor(){super("memf")}getType(){return new r.B5([new r.B5([new r.Hs],new r.Hs),new r.RH],new r.hE([new r.RH],[new s.es(!1)]))}call(e,t,n){const r=e[0],i=e[1];for(const[e,a]of i.vals.entries()){const o=r.accept(new j.u([new J.RD(a,t)],n,t));if(!(0,s.h8)(o))return new s.zG(i.vals.slice(e))}return s.Tg}}class pe extends ee{constructor(){super("ormap",{minArityWithoutLists:1})}getType(e){return new r.B5([new r.B5(new Array(e-1).fill(new r.Hs),new r.wy),...new Array(e-1).fill(new r.RH)],new r.RH)}call(e,t,n){const r=e[0],i=e.slice(1);this.assertListsLength(i,r,t);for(let e=0;e<i[0].vals.length;e++){const a=r.accept(new j.u(i.map((n=>new J.RD(n.vals[e],t))),n,t));if(this.assertBooleanType(a,r,t),(0,s.Zb)(a))return s.Xp}return s.Tg}}class de extends s.em{constructor(){super("procedure?")}getType(){return new r.B5([new r.Hs],new r.wy)}call(e){return(0,s.K_)((0,s.up)(e[0]))}}class we extends ee{constructor(){super("sort")}getType(){return new r.B5([new r.RH,new r.B5([new r.Hs,new r.Hs],new r.wy)],new r.RH)}call(e,t,n){const r=e[0],i=e[1];return new s.zG(r.vals.sort(((e,r)=>{const a=i.accept(new j.u([new J.RD(e,t),new J.RD(r,t)],n,t));return this.assertBooleanType(a,i,t),(0,s.Zb)(a)?-1:1})))}}const me=s.K8;class fe extends s.em{constructor(){super("append",{minArity:2})}getType(e){return new r.B5(new Array(e).fill(new r.RH),new r.RH)}call(e){return new s.zG(e.flatMap((e=>e.vals)))}}class ge extends s.em{constructor(){super("car")}getType(){return new r.B5([new r.FJ],new r.Hs)}call(e){return e[0].vals[0]}}class ve extends s.em{constructor(){super("cdr")}getType(){return new r.B5([new r.FJ],new r.Hs)}call(e){return new s.zG(e[0].vals.slice(1))}}class ye extends s.em{constructor(){super("cons")}getType(){return new r.B5([new r.Hs,new r.RH],new r.RH)}call(e){return new s.zG([e[0],...e[1].vals])}}class xe extends s.em{constructor(){super("eighth")}getType(){return new r.B5([new r.RH(8)],new r.Hs)}call(e){return e[0].vals[7]}}class Ee extends s.em{constructor(e){super(e||"empty?")}getType(){return new r.B5([new r.Hs],new r.wy)}call(e){return(0,s.K_)((0,s.bm)(e[0]))}}class Se extends s.em{constructor(){super("fifth")}getType(){return new r.B5([new r.RH(5)],new r.Hs)}call(e){return e[0].vals[4]}}class be extends s.em{constructor(){super("first")}getType(){return new r.B5([new r.RH(1)],new r.Hs)}call(e){return e[0].vals[0]}}class Te extends s.em{constructor(){super("fourth")}getType(){return new r.B5([new r.RH(4)],new r.Hs)}call(e){return e[0].vals[3]}}class ke extends s.em{constructor(){super("length")}getType(){return new r.B5([new r.RH],new r.D9)}call(e){return a.make(!0,BigInt(e[0].vals.length))}}class Ne extends s.em{constructor(){super("list",{})}getType(e){return new r.B5(new Array(e).fill(new r.Hs),new r.RH(e))}call(e){return new s.zG(e)}}class Ce extends s.em{constructor(){super("list*",{minArity:1})}getType(e){return new r.B5(new Array(e-1).fill(new r.Hs).concat([new r.RH]),new r.RH(e-1))}call(e){return new s.zG(e.slice(0,-1).concat(e[e.length-1].vals))}}class Ae extends s.em{constructor(e){super(e||"list?")}getType(){return new r.B5([new r.Hs],new r.wy)}call(e){return(0,s.K_)((0,s.Dw)(e[0]))}}class $e extends s.em{constructor(){super("make-list")}getType(){return new r.B5([new r.D9,new r.Hs],new r.RH)}call(e){return new s.zG(new Array(Number(e[0].numerator)).fill(e[1]))}}class Me extends s.em{constructor(e){super(e||"member")}getType(){return new r.B5([new r.Hs,new r.RH],new r.wy)}call(e){const t=e[0];return(0,s.K_)((0,s.oh)(t)&&e[1].vals.some((e=>t.equal(e))))}}class Pe extends s.em{constructor(){super("remove")}getType(){return new r.B5([new r.Hs,new r.RH],new r.RH)}call(e){const t=e[0],n=e[1].vals;if((0,s.oh)(t)){for(const[e,r]of n.entries())if(t.equal(r))return new s.zG(n.slice(0,e).concat(n.slice(e+1)));return e[1]}return e[1]}}class Fe extends s.em{constructor(){super("remove-all")}getType(){return new r.B5([new r.Hs,new r.RH],new r.RH)}call(e){const t=e[0];return(0,s.oh)(t)?new s.zG(e[1].vals.filter((e=>!t.equal(e)))):e[1]}}class Be extends s.em{constructor(){super("rest")}getType(){return new r.B5([new r.RH(1)],new r.RH)}call(e){return new s.zG(e[0].vals.slice(1))}}class De extends s.em{constructor(){super("reverse")}getType(){return new r.B5([new r.RH],new r.RH)}call(e){return new s.zG(e[0].vals.reverse())}}class Re extends s.em{constructor(){super("second")}getType(){return new r.B5([new r.RH(2)],new r.Hs)}call(e){return e[0].vals[1]}}class qe extends s.em{constructor(){super("seventh")}getType(){return new r.B5([new r.RH(7)],new r.Hs)}call(e){return e[0].vals[6]}}class _e extends s.em{constructor(){super("sixth")}getType(){return new r.B5([new r.RH(6)],new r.Hs)}call(e){return e[0].vals[5]}}class Le extends s.em{constructor(){super("third")}getType(){return new r.B5([new r.RH(3)],new r.Hs)}call(e){return e[0].vals[2]}}class He extends s.em{constructor(){super("boolean->string")}getType(){return new r.B5([new r.wy],new r.uW)}call(e){return e[0].val?new s.tm("#true"):new s.tm("#false")}}class We extends s.em{constructor(){super("boolean=?")}getType(){return new r.B5([new r.wy,new r.wy],new r.wy)}call(e){return(0,s.K_)(e[0]===e[1])}}class Ze extends s.em{constructor(){super("boolean?")}getType(){return new r.B5([new r.Hs],new r.wy)}call(e){return(0,s.K_)((0,s.JI)(e[0]))}}class Ie extends s.em{constructor(){super("false?")}getType(){return new r.B5([new r.Hs],new r.wy)}call(e){return(0,s.K_)(!1===e[0].val)}}class Oe extends s.em{constructor(){super("not")}getType(){return new r.B5([new r.wy],new r.wy)}call(e){return(0,s.K_)(!e[0].val)}}class Ke extends s.em{constructor(){super("symbol->string")}getType(){return new r.B5([new r.Ko],new r.uW)}call(e){return new s.tm(e[0].val)}}class Ue extends s.em{constructor(){super("symbol=?")}getType(){return new r.B5([new r.Ko,new r.Ko],new r.wy)}call(e){return(0,s.K_)(e[0].val===e[1].val)}}class Ge extends s.em{constructor(){super("symbol?")}getType(){return new r.B5([new r.Hs],new r.wy)}call(e){return(0,s.K_)((0,s.re)(e[0]))}}class Xe extends s.em{constructor(){super("char->integer")}getType(){return new r.B5([new r.sr],new r.D9)}call(e){return a.make(!0,BigInt(e[0].val.charCodeAt(0)))}}class ze extends s.em{constructor(){super("char-alphabetic?")}getType(){return new r.B5([new r.sr],new r.wy)}call(e){return(0,s.K_)(!!e[0].val.match(/^[a-z]$/i))}}class Ve extends s.em{constructor(){super("explode")}getType(){return new r.B5([new r.uW],new r.RH)}call(e){return new s.zG(e[0].val.split("").map((e=>new s.tm(e))))}}class Ye extends s.em{constructor(){super("make-string")}getType(){return new r.B5([new r.D9,new r.sr],new r.uW)}call(e){return new s.tm(e[1].val.repeat(Number(e[0].numerator)))}}class Qe extends s.em{constructor(){super("replicate")}getType(){return new r.B5([new r.D9,new r.uW],new r.uW)}call(e){return new s.tm(e[1].val.repeat(Number(e[0].numerator)))}}class Je extends s.em{constructor(){super("string")}getType(e){return new r.B5(new Array(e).fill(new r.sr),new r.uW)}call(e){return new s.tm(e.map((e=>e.val)).join(""))}}class je extends s.em{constructor(){super("string->symbol")}getType(){return new r.B5([new r.uW],new r.Ko)}call(e){return new s.iN(e[0].val)}}class et extends s.em{constructor(){super("string-alphabetic?")}getType(){return new r.B5([new r.uW],new r.wy)}call(e){return(0,s.K_)(!!e[0].val.match(/^[a-z]*$/i))}}class tt extends s.em{constructor(){super("string-append",{minArity:2,relaxedMinArity:1})}getType(e){return new r.B5(new Array(e).fill(new r.uW),new r.uW)}call(e){return new s.tm(e.map((e=>e.val)).join(""))}}class nt extends s.em{constructor(){super("string-ci<=?",{minArity:2,relaxedMinArity:1})}getType(e){return new r.B5(new Array(e).fill(new r.uW),new r.wy)}call(e){for(let t=0;t<e.length-1;t++)if(!(e[t].val.toLowerCase()<=e[t+1].val.toLowerCase()))return s.Tg;return s.Xp}}class st extends s.em{constructor(){super("string-ci<?",{minArity:2,relaxedMinArity:1})}getType(e){return new r.B5(new Array(e).fill(new r.uW),new r.wy)}call(e){for(let t=0;t<e.length-1;t++)if(!(e[t].val.toLowerCase()<e[t+1].val.toLowerCase()))return s.Tg;return s.Xp}}class rt extends s.em{constructor(){super("string-ci=?",{minArity:2,relaxedMinArity:1})}getType(e){return new r.B5(new Array(e).fill(new r.uW),new r.wy)}call(e){for(let t=0;t<e.length-1;t++)if(e[t].val.toLowerCase()!==e[t+1].val.toLowerCase())return s.Tg;return s.Xp}}class it extends s.em{constructor(){super("string-ci>=?",{minArity:2,relaxedMinArity:1})}getType(e){return new r.B5(new Array(e).fill(new r.uW),new r.wy)}call(e){for(let t=0;t<e.length-1;t++)if(!(e[t].val.toLowerCase()>=e[t+1].val.toLowerCase()))return s.Tg;return s.Xp}}class at extends s.em{constructor(){super("string-ci>?",{minArity:2,relaxedMinArity:1})}getType(e){return new r.B5(new Array(e).fill(new r.uW),new r.wy)}call(e){for(let t=0;t<e.length-1;t++)if(!(e[t].val.toLowerCase()>=e[t+1].val.toLowerCase()))return s.Tg;return s.Xp}}class ot extends s.em{constructor(){super("string-contains-ci?")}getType(){return new r.B5([new r.uW,new r.uW],new r.wy)}call(e){return(0,s.K_)(e[1].val.toLowerCase().includes(e[0].val.toLowerCase()))}}class ct extends s.em{constructor(){super("string-contains?")}getType(){return new r.B5([new r.uW,new r.uW],new r.wy)}call(e){return(0,s.K_)(e[1].val.includes(e[0].val))}}class ut extends s.em{constructor(){super("string-copy")}getType(){return new r.B5([new r.uW],new r.uW)}call(e){return new s.tm(e[0].val)}}class lt extends s.em{constructor(){super("string-downcase")}getType(){return new r.B5([new r.uW],new r.uW)}call(e){return new s.tm(e[0].val.toLowerCase())}}class ht extends s.em{constructor(){super("string-length")}getType(){return new r.B5([new r.uW],new r.D9)}call(e){return new s.pv(BigInt(e[0].val.length))}}class pt extends s.em{constructor(){super("string-lower-case?")}getType(){return new r.B5([new r.uW],new r.wy)}call(e){return(0,s.K_)(!!e[0].val.match(/^[a-z]*$/))}}class dt extends s.em{constructor(){super("string-numeric?")}getType(){return new r.B5([new r.uW],new r.wy)}call(e){return(0,s.K_)(!!e[0].val.match(/^[0-9]*$/))}}class wt extends s.em{constructor(){super("string-upcase")}getType(){return new r.B5([new r.uW],new r.uW)}call(e){return new s.tm(e[0].val.toUpperCase())}}class mt extends s.em{constructor(){super("string-upper-case?")}getType(){return new r.B5([new r.uW],new r.wy)}call(e){return(0,s.K_)(!!e[0].val.match(/^[A-Z]*$/))}}class ft extends s.em{constructor(){super("string<=?",{minArity:2,relaxedMinArity:1})}getType(e){return new r.B5(new Array(e).fill(new r.uW),new r.wy)}call(e){for(let t=0;t<e.length-1;t++)if(!(e[t].val<=e[t+1].val))return s.Tg;return s.Xp}}class gt extends s.em{constructor(){super("string<?",{minArity:2,relaxedMinArity:1})}getType(e){return new r.B5(new Array(e).fill(new r.uW),new r.wy)}call(e){for(let t=0;t<e.length-1;t++)if(!(e[t].val<e[t+1].val))return s.Tg;return s.Xp}}class vt extends s.em{constructor(){super("string=?",{minArity:2,relaxedMinArity:1})}getType(e){return new r.B5(new Array(e).fill(new r.uW),new r.wy)}call(e){for(let t=0;t<e.length-1;t++)if(e[t].val!==e[t+1].val)return s.Tg;return s.Xp}}class yt extends s.em{constructor(){super("string>=?",{minArity:2,relaxedMinArity:1})}getType(e){return new r.B5(new Array(e).fill(new r.uW),new r.wy)}call(e){for(let t=0;t<e.length-1;t++)if(!(e[t].val>=e[t+1].val))return s.Tg;return s.Xp}}class xt extends s.em{constructor(){super("string>?",{minArity:2,relaxedMinArity:1})}getType(e){return new r.B5(new Array(e).fill(new r.uW),new r.wy)}call(e){for(let t=0;t<e.length-1;t++)if(!(e[t].val>=e[t+1].val))return s.Tg;return s.Xp}}class Et extends s.em{constructor(){super("string?")}getType(){return new r.B5([new r.Hs],new r.wy)}call(e){return(0,s.K_)((0,s.$e)(e[0]))}}var St=n(484),bt=n(223),Tt=n(625),kt=n(239),Nt=n(159),Ct=n(830);const At=new Ct.yC((0,Nt.oM)(0,0)[0]);class $t extends s.em{constructor(){super("circle")}getType(){return new r.B5([new r.Y5,new kt.XG,new kt.Mr],new kt.__)}call(e){const t=Number(e[0].numerator),n=e[1],s=e[2],[r,i]=(0,Nt.oM)(2*t,2*t);return i.fillStyle=(0,Nt.$w)(s,n),i.beginPath(),(0,Nt.Nf)(n)&&t>Nt.q2?(i.arc(t,t,t+Nt.ko,0,Nt.gc),i.fill(),i.fillStyle=Nt.Et,i.beginPath(),i.arc(t,t,t-Nt.ko,0,Nt.gc),i.fill()):(i.arc(t,t,t,0,Nt.gc),i.fill()),new Ct.yC(r)}}class Mt extends s.em{constructor(){super("ellipse")}getType(){return new r.B5([new r.Y5,new r.Y5,new kt.XG,new kt.Mr],new kt.__)}call(e){const t=Number(e[0].numerator),n=Number(e[1].numerator),s=e[2],r=e[3],[i,a]=(0,Nt.oM)(t,n),o=t/2,c=n/2;return a.fillStyle=(0,Nt.$w)(r,s),a.beginPath(),(0,Nt.Nf)(s)&&t>Nt.q2&&n>Nt.q2?(a.ellipse(o,c,o+Nt.ko,c+Nt.ko,0,0,Nt.gc),a.fill(),a.fillStyle=Nt.Et,a.beginPath(),a.ellipse(o,c,o-Nt.ko,c-Nt.ko,0,0,Nt.gc),a.fill()):(a.ellipse(o,c,o,c,0,0,Nt.gc),a.fill()),new Ct.yC(i)}}class Pt extends s.em{constructor(){super("beside",{minArity:2})}getType(e){return new r.B5(new Array(e).fill(new kt.__),new kt.__)}call(e){let t=0,n=0;for(const s of e)t+=s.canvas.width,n=Math.max(n,s.canvas.height);const[s,r]=(0,Nt.oM)(t,n);let i=0;for(const t of e)(0,Ct.re)(t)||(r.drawImage(t.canvas,i,(n-t.canvas.height)/2),i+=t.canvas.width);return new Ct.yC(s)}}class Ft extends s.em{constructor(){super("above",{minArity:2})}getType(e){return new r.B5(new Array(e).fill(new kt.__),new kt.__)}call(e){let t=0,n=0;for(const s of e)t=Math.max(t,s.canvas.width),n+=s.canvas.height;const[s,r]=(0,Nt.oM)(t,n);let i=0;for(const n of e)(0,Ct.re)(n)||(r.drawImage(n.canvas,(t-n.canvas.width)/2,i),i+=n.canvas.height);return new Ct.yC(s)}}class Bt extends s.em{constructor(){super("image-width")}getType(){return new r.B5([new kt.__],new r.Y5)}call(e){const t=e[0];return a.make(!0,BigInt(t.canvas.width))}}class Dt extends s.em{constructor(){super("image-height")}getType(){return new r.B5([new kt.__],new r.Y5)}call(e){const t=e[0];return a.make(!0,BigInt(t.canvas.height))}}class Rt extends s.em{constructor(){super("square")}getType(){return new r.B5([new r.Y5,new kt.XG,new kt.Mr],new kt.__)}call(e){const t=Number(e[0].numerator),n=e[1],s=e[2],[r,i]=(0,Nt.oM)(t,t);return i.fillStyle=(0,Nt.$w)(s,n),i.beginPath(),(0,Nt.Nf)(n)&&t>Nt.q2?(i.rect(-Nt.ko,-Nt.ko,t+Nt.ko,t+Nt.ko),i.fill(),i.fillStyle=Nt.Et,i.beginPath(),i.rect(Nt.ko,Nt.ko,t-Nt.q2,t-Nt.q2),i.fill()):(i.rect(0,0,t,t),i.fill()),new Ct.yC(r)}}class qt extends s.em{constructor(){super("rectangle")}getType(){return new r.B5([new r.Y5,new r.Y5,new kt.XG,new kt.Mr],new kt.__)}call(e){const t=Number(e[0].numerator),n=Number(e[1].numerator),s=e[2],r=e[3],[i,a]=(0,Nt.oM)(t,n);return a.fillStyle=(0,Nt.$w)(r,s),a.beginPath(),(0,Nt.Nf)(s)&&t>Nt.q2&&n>Nt.q2?(a.rect(-Nt.ko,-Nt.ko,t+Nt.ko,n+Nt.ko),a.fill(),a.fillStyle=Nt.Et,a.beginPath(),a.rect(Nt.ko,Nt.ko,t-Nt.q2,n-Nt.q2),a.fill()):(a.rect(0,0,t,n),a.fill()),new Ct.yC(i)}}class _t extends s.em{constructor(){super("image?")}getType(){return new r.B5([new r.Hs],new r.wy)}call(e){return(0,s.K_)((0,Ct.gf)(e[0]))}}class Lt extends s.em{constructor(e=null){super(e||"make-color")}getType(e){return new r.B5(new Array(Math.max(3,Math.min(4,e))).fill(new kt.e6),new kt.Mr)}call(e){const t=e[0],n=e[1],r=e[2],i=e[3]||a.make(!0,255n);return new s.$z("color",[t,n,r,i])}}new s.Y2("color",3).getType=()=>new r.B5(new Array(3).fill(new kt.e6),new kt.Mr);const Ht={name:"2htdp/image",procedures:[new Lt("color"),new Lt,new s.Vq("color"),new s.If("color","red",0),new s.If("color","green",1),new s.If("color","blue",2),new s.If("color","alpha",3),new $t,new Mt,new Rt,new qt,new Pt,new Ft,new Bt,new Dt,new _t],data:new Map([["empty-image",At]])},Wt={name:"2htdp/universe",procedures:[],data:new Map([])};class Zt{constructor(){if(this.higherOrderFunctions=new Set([new te,new ne,new se,new re,new ie,new ae,new oe,new ce,new ue,new le,new he,new pe,new de,new we]),Zt.instance)return Zt.instance;Zt.instance=this,this.primitiveScope=new St.s,this.primitiveRelaxedScope=new St.s,this.primitiveEnvironment=new bt.q,this.primitiveDataNames=new Set,this.primitiveStructNames=new Set,this.primitiveProcedures=new Map,this.primitiveTestFunctions=new Map,this.modules=new Map,this.primitiveTestFunctions.set(Tt.Z.CheckError,{minArity:1,maxArity:2}),this.primitiveTestFunctions.set(Tt.Z.CheckExpect,{arity:2}),this.primitiveTestFunctions.set(Tt.Z.CheckMemberOf,{minArity:2}),this.primitiveTestFunctions.set(Tt.Z.CheckRandom,{arity:2}),this.primitiveTestFunctions.set(Tt.Z.CheckRange,{arity:3}),this.primitiveTestFunctions.set(Tt.Z.CheckSatisfied,{arity:2}),this.primitiveTestFunctions.set(Tt.Z.CheckWithin,{arity:3}),this.addDataToPrimEnv("empty",s.K8),this.addDataToPrimEnv("true",s.Xp),this.addDataToPrimEnv("false",s.Tg),this.addFnToPrimEnv(new h),this.addFnToPrimEnv(new p),this.addFnToPrimEnv(new d),this.addFnToPrimEnv(new w),this.addFnToPrimEnv(new m),this.addFnToPrimEnv(new f),this.addFnToPrimEnv(new g),this.addFnToPrimEnv(new v),this.addFnToPrimEnv(new y),this.addFnToPrimEnv(new x),this.addFnToPrimEnv(new E),this.addFnToPrimEnv(new S),this.addFnToPrimEnv(new b),this.addFnToPrimEnv(new T),this.addFnToPrimEnv(new k),this.addFnToPrimEnv(new N),this.addDataToPrimEnv("e",u),this.addFnToPrimEnv(new C),this.addFnToPrimEnv(new A),this.addFnToPrimEnv(new $),this.addFnToPrimEnv(new M),this.addFnToPrimEnv(new P),this.addFnToPrimEnv(new F),this.addFnToPrimEnv(new B),this.addFnToPrimEnv(new D),this.addFnToPrimEnv(new R),this.addFnToPrimEnv(new q),this.addFnToPrimEnv(new _),this.addFnToPrimEnv(new L),this.addFnToPrimEnv(new H),this.addFnToPrimEnv(new W),this.addDataToPrimEnv("pi",l),this.addFnToPrimEnv(new Z),this.addFnToPrimEnv(new I),this.addFnToPrimEnv(new O),this.addFnToPrimEnv(new K),this.addFnToPrimEnv(new L("rational?")),this.addFnToPrimEnv(new L("real?")),this.addFnToPrimEnv(new U),this.addFnToPrimEnv(new X),this.addFnToPrimEnv(new G),this.addFnToPrimEnv(new z),this.addFnToPrimEnv(new V),this.addFnToPrimEnv(new Y),this.addFnToPrimEnv(new He),this.addFnToPrimEnv(new We),this.addFnToPrimEnv(new Ze),this.addFnToPrimEnv(new Ie),this.addFnToPrimEnv(new Oe),this.addFnToPrimEnv(new Ke),this.addFnToPrimEnv(new Ue),this.addFnToPrimEnv(new Ge),this.addFnToPrimEnv(new fe),this.addFnToPrimEnv(new ge),this.addFnToPrimEnv(new ve),this.addFnToPrimEnv(new ye),this.addFnToPrimEnv(new Ae("cons?")),this.addFnToPrimEnv(new xe),this.addFnToPrimEnv(new Ee),this.addFnToPrimEnv(new Se),this.addFnToPrimEnv(new be),this.addFnToPrimEnv(new Te),this.addFnToPrimEnv(new ke),this.addFnToPrimEnv(new Ne),this.addFnToPrimEnv(new Ce),this.addFnToPrimEnv(new Ae),this.addFnToPrimEnv(new $e),this.addFnToPrimEnv(new Me),this.addFnToPrimEnv(new Me("member?")),this.addDataToPrimEnv("null",me),this.addFnToPrimEnv(new Ee("null?")),this.addFnToPrimEnv(new Pe),this.addFnToPrimEnv(new Fe),this.addFnToPrimEnv(new Be),this.addFnToPrimEnv(new De),this.addFnToPrimEnv(new Re),this.addFnToPrimEnv(new qe),this.addFnToPrimEnv(new _e),this.addFnToPrimEnv(new Le),this.addStructToPrimEnv("posn",["x","y"]),this.addFnToPrimEnv(new Xe),this.addFnToPrimEnv(new ze),this.addFnToPrimEnv(new Ve),this.addFnToPrimEnv(new Ye),this.addFnToPrimEnv(new Qe),this.addFnToPrimEnv(new Je),this.addFnToPrimEnv(new je),this.addFnToPrimEnv(new et),this.addFnToPrimEnv(new tt),this.addFnToPrimEnv(new nt),this.addFnToPrimEnv(new st),this.addFnToPrimEnv(new rt),this.addFnToPrimEnv(new it),this.addFnToPrimEnv(new at),this.addFnToPrimEnv(new ot),this.addFnToPrimEnv(new ct),this.addFnToPrimEnv(new ut),this.addFnToPrimEnv(new lt),this.addFnToPrimEnv(new ht),this.addFnToPrimEnv(new pt),this.addFnToPrimEnv(new dt),this.addFnToPrimEnv(new wt),this.addFnToPrimEnv(new mt),this.addFnToPrimEnv(new ft),this.addFnToPrimEnv(new gt),this.addFnToPrimEnv(new vt),this.addFnToPrimEnv(new yt),this.addFnToPrimEnv(new xt),this.addFnToPrimEnv(new Et),this.addFnToPrimEnv(new Q.Fk),this.addDataToPrimEnv("eof",Q.yv),this.addFnToPrimEnv(new Q.DA),this.addFnToPrimEnv(new Q.OO),this.addFnToPrimEnv(new Q._r),this.addFnToPrimEnv(new Q.a_),this.addFnToPrimEnv(new Q.h8),this.addFnToPrimEnv(new Q.b7),this.addFnToPrimEnv(new Q.KY),this.addFnToPrimEnv(new Q.JM),this.defineScopes(),this.addModule(Ht),this.addModule(Wt)}enableHigherOrderFunctions(){this.higherOrderFunctions.forEach((e=>this.addFnToPrimEnv(e))),this.defineScopes()}disableHigherOrderFunctions(){this.higherOrderFunctions.forEach((e=>this.deleteFnFormPrimEnv(e))),this.defineScopes()}addDataToPrimEnv(e,t){this.primitiveEnvironment.set(e,t),this.primitiveDataNames.add(e)}addFnToPrimEnv(e){this.primitiveEnvironment.set(e.name,e),this.primitiveProcedures.set(e.name,e)}deleteFnFormPrimEnv(e){this.primitiveEnvironment.delete(e.name),this.primitiveProcedures.delete(e.name)}addStructToPrimEnv(e,t){const n=new s.Bb(e),r=new s.Y2(e,t.length),i=new s.Vq(e),a=t.map(((t,n)=>new s.If(e,t,n)));this.primitiveEnvironment.set(e,n),this.primitiveEnvironment.set(`make-${e}`,r),this.primitiveEnvironment.set(`${e}?`,i),a.forEach((t=>{this.primitiveEnvironment.set(`${e}-${t.fieldName}`,t)})),this.primitiveStructNames.add(e),this.primitiveProcedures.set(`make-${e}`,r),this.primitiveProcedures.set(`${e}?`,i),a.forEach((t=>{this.primitiveProcedures.set(`${e}-${t.fieldName}`,t)}))}defineScopes(){this.primitiveDataNames.forEach((e=>this.primitiveScope.set(e,St.x.Data))),this.primitiveProcedures.forEach(((e,t)=>{void 0!==e.config.relaxedMinArity&&this.primitiveRelaxedScope.set(t,St.x.PrimitiveFunction),this.primitiveScope.set(t,St.x.PrimitiveFunction)})),this.primitiveStructNames.forEach((e=>this.primitiveScope.set(e,St.x.StructureType)))}addModule(e){this.modules.set(e.name,e)}}},789:(e,t,n)=>{n.d(t,{Ov:()=>y,RD:()=>x,c$:()=>l,rx:()=>h,Up:()=>u,Us:()=>p,p8:()=>d,Et:()=>w,r_:()=>E,pW:()=>f,ho:()=>g,PM:()=>S,bK:()=>b,xf:()=>$,yq:()=>T,kt:()=>k,p7:()=>N,PJ:()=>C,O1:()=>A,s5:()=>M,fY:()=>P,HF:()=>F,Mf:()=>B,xX:()=>D,O0:()=>R,Gg:()=>q});var s=n(34),r=n(484),i=n(1),a=n(625),o=n(432);class c{constructor(e){this.sourceSpan=e,this.used=!1,this.label=""}isTemplate(){return!1}use(){this.used=!0}}class u extends c{constructor(e,t,n){super(n),this.name=e,this.args=t,this.sourceSpan=n}accept(e){return e.visitCheckNode(this)}}class l extends u{constructor(e,t){super(a.Z.CheckError,e,t),this.args=e,this.sourceSpan=t}accept(e){return _(e)?e.visitCheckErrorNode(this):e.visitCheckNode(this)}}class h extends u{constructor(e,t,n,s){super(a.Z.CheckMemberOf,[t,...n],s),this.arg=e,this.testValNode=t,this.testAgainstValNodes=n,this.sourceSpan=s}accept(e){return _(e)?e.visitCheckMemberOfNode(this):e.visitCheckNode(this)}}class p extends u{constructor(e,t,n,s,r){super(a.Z.CheckRange,[t,n,s],r),this.arg=e,this.testValNode=t,this.lowerBoundValNode=n,this.upperBoundValNode=s,this.sourceSpan=r}accept(e){return _(e)?e.visitCheckRangeNode(this):e.visitCheckNode(this)}}class d extends u{constructor(e,t,n,s,r){super(a.Z.CheckSatisfied,[t,n],r),this.arg=e,this.testValNode=t,this.testFnNode=n,this.testFnName=s,this.sourceSpan=r}accept(e){return _(e)?e.visitCheckSatisfiedNode(this):e.visitCheckNode(this)}}class w extends u{constructor(e,t,n,s,r){super(a.Z.CheckWithin,[t,n,s],r),this.arg=e,this.actualNode=t,this.expectedNode=n,this.withinNode=s,this.sourceSpan=r}accept(e){return _(e)?e.visitCheckWithinNode(this):e.visitCheckNode(this)}}class m extends c{constructor(e,t,n){super(n),this.name=e,this.nameSourceSpan=t,this.sourceSpan=n}addToScope(e,t=!1){if(e.has(this.name))throw new o.ME((0,s.B)(this.name),this.nameSourceSpan)}}class f extends m{constructor(e,t,n,s){super(e,t,s),this.name=e,this.nameSourceSpan=t,this.fields=n,this.sourceSpan=s}accept(e){return e.visitDefnStructNode(this)}addToScope(e,t=!1){if(!t){if(super.addToScope(e),e.has(`make-${this.name}`))throw new o.ME((0,s.B)(`make-${this.name}`),this.sourceSpan);if(e.has(`${this.name}?`))throw new o.ME((0,s.B)(`${this.name}?`),this.sourceSpan);this.fields.forEach((t=>{if(e.has(`${this.name}-${t}`))throw new o.ME((0,s.B)(`${this.name}-${t}`),this.sourceSpan)}))}e.set(this.name,r.x.StructureType),e.set(`make-${this.name}`,r.x.UserDefinedFunction),e.set(`${this.name}?`,r.x.UserDefinedFunction),this.fields.forEach((t=>{e.set(`${this.name}-${t}`,r.x.UserDefinedFunction)}))}}class g extends m{constructor(e,t,n,s){super(e,t,s),this.name=e,this.nameSourceSpan=t,this.value=n,this.sourceSpan=s}accept(e){return e.visitDefnVarNode(this)}isTemplate(){return this.value.isTemplate()}addToScope(e,t=!1){t||super.addToScope(e),this.value instanceof k?e.set(this.name,r.x.UserDefinedFunction):e.set(this.name,r.x.Data)}}class v extends c{}class y extends v{constructor(e,t){super(t),this.args=e,this.sourceSpan=t}accept(e){return e.visitAndNode(this)}isTemplate(){return this.args.some((e=>e.isTemplate()))}}class x extends v{constructor(e,t){super(t),this.rval=e,this.sourceSpan=t}accept(e){return e.visitAtomNode(this)}}class E extends v{constructor(e,t){super(t),this.questionAnswerClauses=e,this.sourceSpan=t}accept(e){return e.visitCondNode(this)}isTemplate(){return this.questionAnswerClauses.some((e=>e[0].isTemplate()||e[1].isTemplate()))}}class S extends v{constructor(e,t){super(t),this.placeholder=e,this.sourceSpan=t}accept(e){return e.visitEllipsisProcAppNode(this)}isTemplate(){return!0}}class b extends v{constructor(e,t){super(t),this.placeholder=e,this.sourceSpan=t}accept(e){return e.visitEllipsisNode(this)}isTemplate(){return!0}}class T extends v{constructor(e,t,n,s){super(s),this.question=e,this.trueAnswer=t,this.falseAnswer=n,this.sourceSpan=s}accept(e){return e.visitIfNode(this)}isTemplate(){return this.question.isTemplate()||this.trueAnswer.isTemplate()||this.falseAnswer.isTemplate()}}class k extends v{constructor(e,t,n,s){super(s),this.params=t,this.body=n,this.sourceSpan=s,this.name=e}accept(e){return e.visitLambdaNode(this)}isTemplate(){return this.body.isTemplate()}}class N extends v{constructor(e,t,n,s){super(s),this.name=e,this.bindings=t,this.body=n,this.sourceSpan=s}accept(e){return e.visitLetNode(this)}}class C extends v{constructor(e,t,n){super(n),this.defns=e,this.body=t,this.sourceSpan=n}accept(e){return e.visitLocalNode(this)}isTemplate(){return this.defns.some((e=>e.isTemplate()))||this.body.isTemplate()}}class A extends v{constructor(e,t){super(t),this.args=e,this.sourceSpan=t}accept(e){return e.visitOrNode(this)}isTemplate(){return this.args.some((e=>e.isTemplate()))}}class $ extends v{constructor(e,t,n){super(n),this.fn=e,this.args=t,this.sourceSpan=n}accept(e){return e.visitProcAppNode(this)}isTemplate(){return this.args.some((e=>e.isTemplate()))}}class M extends v{constructor(e,t,n){super(n),this.name=e,this.nameSourceSpan=t,this.sourceSpan=n,this.global=new i.x}accept(e){return e.visitRequireNode(this)}addToScope(e){const t=this.global.modules.get(this.name);if(!t)throw new o.ME((0,s.R6)(this.name),this.nameSourceSpan);for(const n of t.procedures)e.has(n.getName())||e.set(n.getName(),r.x.PrimitiveFunction);for(const n of t.data.keys())e.has(n)||e.set(n,r.x.Data)}}class P extends v{constructor(e,t){super(t),this.name=e,this.sourceSpan=t}accept(e){return e.visitVarNode(this)}}function F(e){return e instanceof u}function B(e){return e instanceof m}function D(e){return e instanceof k}function R(e){return e instanceof M}function q(e){return e instanceof P}function _(e){return"visitCheckErrorNode"in e}},326:(e,t,n)=>{function s(e,t){return{token:e,sourceSpan:t}}function r(e,t){return{subSExprs:e,sourceSpan:t}}function i(e){return"token"in e}function a(e){return"subSExprs"in e}n.d(t,{Xy:()=>s,Rp:()=>r,F:()=>i,MW:()=>a})},813:(e,t,n)=>{var s;n.d(t,{W:()=>r,i:()=>s}),function(e){e[e.LeftParen=0]="LeftParen",e[e.True=1]="True",e[e.False=2]="False",e[e.Character=3]="Character",e[e.String=4]="String",e[e.Name=5]="Name",e[e.Keyword=6]="Keyword",e[e.Integer=7]="Integer",e[e.Rational=8]="Rational",e[e.Decimal=9]="Decimal",e[e.Placeholder=10]="Placeholder"}(s||(s={}));class r{constructor(e,t,n){this.type=e,this.text=t,this.sourceSpan=n}}},751:(e,t,n)=>{var s=n(432),r=n(96),i=n(1);class a{constructor(){this.global=new i.x,this.currentInt=0}run(e){return this.currentInt=0,e.output.nodes.forEach((e=>e.accept(this))),(0,s.mf)(void 0)}visitAndNode(e){e.label=`and_${this.nextInt()}`,e.args.forEach((e=>e.accept(this)))}visitAtomNode(e){e.label=`atom_${this.nextInt()}`}visitCheckNode(e){e.label=`check_${this.nextInt()}`,e.args.forEach((e=>e.accept(this)))}visitCondNode(e){e.label=`cond_${this.nextInt()}`,e.questionAnswerClauses.forEach((([e,t])=>{e.accept(this),t.accept(this)}))}visitDefnStructNode(e){e.label=`defn_struct_${this.nextInt()}`}visitDefnVarNode(e){e.label=`defn_var_${this.nextInt()}`,e.value.accept(this)}visitEllipsisProcAppNode(e){e.label=`ellipsis_proc_app_${this.nextInt()}`}visitEllipsisNode(e){e.label=`ellipsis_${this.nextInt()}`}visitIfNode(e){e.label=`if_${this.nextInt()}`,e.question.accept(this),e.trueAnswer.accept(this),e.falseAnswer.accept(this)}visitLambdaNode(e){e.label=`lambda_${this.nextInt()}`,e.body.accept(this)}visitLetNode(e){e.label=`let_${this.nextInt()}`,e.bindings.forEach((([e,t])=>t.accept(this))),e.body.accept(this)}visitLocalNode(e){e.label=`local_${this.nextInt()}`,e.defns.forEach((e=>e.accept(this))),e.body.accept(this)}visitOrNode(e){e.label=`or_${this.nextInt()}`,e.args.forEach((e=>e.accept(this)))}visitProcAppNode(e){e.label=`proc_app_${this.nextInt()}`,e.fn.accept(this),e.args.forEach((e=>e.accept(this)))}visitRequireNode(e){e.label=`require_${this.nextInt()}`}visitVarNode(e){e.label=`var_${this.nextInt()}`}nextInt(){return this.currentInt++}}var o=n(326),c=n(34),u=n(226),l=n(813),h=n(625),p=n(870);const d=/[\s"'([{)\]};`,]/,w=/^[([{]$/,m=/^[)\]}]$/,f=/^#(T|t|true)$/,g=/^#(F|f|false)$/,v=/^[+-]?\d+\.?$/,y=/^[+-]?\d+\/\d+$/,x=/^[+-]?\d*\.\d+$/,E=/^[+-]?\d+\/0+$/,S=/^\.{2,6}$/,b=/^#\\(nul|null|backspace|tab|newline|linefeed|vtab|page|return|space|rubout)$/,T=String.fromCharCode(7),k=String.fromCharCode(8),N=String.fromCharCode(9),C=String.fromCharCode(10),A=String.fromCharCode(11),$=String.fromCharCode(12),M=String.fromCharCode(13),P=String.fromCharCode(27);class F{run(e){this.position=0,this.lineno=1,this.colno=0,this.input=e.output,this.atEnd=0===this.input.length,this.quoting=!1,this.quasiQuoting=!1;const t=[];try{const e=this.eatSpace();for(;!this.atEnd;){const n=this.nextSExpr();e.length>0?e.pop():t.push(n),e.push(...this.eatSpace())}if(e.length>0)throw new s.ME(c.C_,e.pop());return(0,s.mf)(t)}catch(e){if(e instanceof s.ME)return(0,s.mf)([],[e]);throw e}}nextSExpr(){const e=this.next();if(e.match(w))return this.nextListSExpr(e);if(e.match(m))throw new s.ME((0,c.dx)(e),(0,u.D)(this.lineno,this.colno-1,this.lineno,this.colno));if("#"===e)return this.nextPoundSExpr();if("'"===e)return this.nextQuotedSExpr();if("`"===e){if(!p.L.syntax.quasiquoting)throw new s.ME((0,c.bf)("`"),(0,u.D)(this.lineno,this.colno-1,this.lineno,this.colno));return this.nextQuotedSExpr(!0)}if('"'===e)return this.nextString();if(","===e){if(!p.L.syntax.quasiquoting)throw new s.ME((0,c.bf)(","),(0,u.D)(this.lineno,this.colno-1,this.lineno,this.colno));return this.nextUnquotedSExpr()}const t=this.lineno;this.position--,this.atEnd=!1;const n=--this.colno,r=this.nextName(),i=(0,u.D)(t,n,this.lineno,this.colno);let a;if("."===r)throw new s.ME((0,c.bf)("."),i);if(r.match(v))a=l.i.Integer;else if(r.match(y)){if(r.match(E))throw new s.ME((0,c.zv)(r),i);a=l.i.Rational}else a=r.match(x)?l.i.Decimal:p.L.syntax.forms.includes(r)?l.i.Keyword:r.match(S)?l.i.Placeholder:l.i.Name;return(0,o.Xy)(new l.W(a,r,i),i)}nextListSExpr(e){const t=this.lineno,n=this.colno-1,r=[],i=this.eatSpace();for(;!this.atEnd&&!this.peek().match(m);){const e=this.nextSExpr();i.length>0?i.pop():r.push(e),i.push(...this.eatSpace())}if(this.atEnd)throw new s.ME((0,c.rO)(e),(0,u.D)(t,n,t,n+1));const a=this.next();if(i.length>0)throw new s.ME((0,c.dx)(a),(0,u.D)(this.lineno,this.colno-1,this.lineno,this.colno));if(!this.parenMatches(e,a))throw new s.ME((0,c.An)(e,a),(0,u.D)(this.lineno,this.colno-1,this.lineno,this.colno));return(0,o.Rp)(r,(0,u.D)(t,n,this.lineno,this.colno))}nextPoundSExpr(){const e=this.lineno,t=this.colno-1,n=(0,u.D)(e,t,e,t+1);if(this.atEnd)throw new s.ME((0,c.vN)("#"),n);if(this.peek().match(d)){const n=this.next();throw new s.ME((0,c.vN)("#"+n),(0,u.D)(e,t,this.lineno,this.colno))}if(this.match("\\"))return this.nextCharacter();let r="#";for(;!this.atEnd&&!this.peek().match(d);)r+=this.next();const i=(0,u.D)(e,t,this.lineno,this.colno);if(r.match(f))return(0,o.Xy)(new l.W(l.i.True,r,i),i);if(r.match(g))return(0,o.Xy)(new l.W(l.i.False,r,i),i);throw new s.ME((0,c.vN)(r),i)}nextQuotedSExpr(e=!1){const t=this.lineno,n=this.colno-1,r=(0,u.D)(t,n,t,n+1);if(this.quoting||this.quasiQuoting)throw new s.ME(c.vV,r);e?this.quasiQuoting=!0:this.quoting=!0;const i=this.eatSpace();for(;i.length>0;){if(this.atEnd)throw new s.ME(c.C_,i.pop());this.nextSExpr(),i.pop(),i.push(...this.eatSpace())}if(this.atEnd)throw new s.ME((0,c.fW)("end-of-file"),r);const a=this.nextSExpr();return this.quoting=!1,this.quasiQuoting=!1,(0,o.Rp)([(0,o.Xy)(new l.W(l.i.Keyword,e?h.Z.Quasiquote:h.Z.Quote,r),r),a],(0,u.D)(t,n,this.lineno,this.colno))}nextCharacter(){const e=this.lineno,t=this.colno-2;let n="#\\";if(this.atEnd)throw new s.ME(c.WA,(0,u.D)(e,t,this.lineno,this.colno));if(n+=this.next(),n.match(/#\\[^a-z]/i)){const s=(0,u.D)(e,t,this.lineno,this.colno);return(0,o.Xy)(new l.W(l.i.Character,n,s),s)}for(;!this.atEnd&&this.peek().match(/[a-z]/i);)n+=this.next();const r=(0,u.D)(e,t,this.lineno,this.colno);if(n.length-2>1&&!n.match(b))throw new s.ME((0,c.wS)(n),r);return(0,o.Xy)(new l.W(l.i.Character,n,r),r)}nextString(){const e=this.lineno,t=this.colno-1;let n='"';for(;!this.atEnd;){const r=this.next();switch(r){case'"':return(0,o.Xy)(new l.W(l.i.String,n+'"',(0,u.D)(e,t,this.lineno,this.colno)),(0,u.D)(e,t,this.lineno,this.colno));case"\\":{if(this.atEnd)throw new s.ME(c.qR,(0,u.D)(e,t,this.lineno,this.colno));const r=this.next();switch(r){case"a":n+=T;break;case"b":n+=k;break;case"t":n+=N;break;case"n":n+=C;break;case"v":n+=A;break;case"f":n+=$;break;case"r":n+=M;break;case"e":n+=P;break;case'"':case"'":case"\\":n+=r;break;case"\n":break;case"\r":this.match("\n");break;default:throw new s.ME((0,c.JC)(r),(0,u.D)(this.lineno,this.colno-2,this.lineno,this.colno))}break}default:n+=r}}throw new s.ME(c.qR,(0,u.D)(e,t,this.lineno,this.colno))}nextUnquotedSExpr(){const e=this.lineno,t=this.colno-1,n=(0,u.D)(e,t,e,t+1);if(!this.quasiQuoting)throw new s.ME((0,c.R9)("unquote","comma"),n);const r=this.eatSpace();for(;r.length>0;){if(this.atEnd)throw new s.ME(c.C_,r.pop());this.nextSExpr(),r.pop(),r.push(...this.eatSpace())}if(this.atEnd)throw new s.ME((0,c.cN)("end-of-file"),n);const i=this.nextSExpr();return(0,o.Rp)([(0,o.Xy)(new l.W(l.i.Keyword,h.Z.Unquote,n),n),i],(0,u.D)(e,t,this.lineno,this.colno))}nextName(){const e=this.lineno,t=this.colno;let n="";for(;!this.atEnd&&!this.peek().match(d);){const r=this.next();if("\\"===r){if(this.atEnd)throw new s.ME(c.ne,(0,u.D)(e,t,this.lineno,this.colno));n+=this.next()}else if("|"===r){const e=this.lineno,t=this.colno;do{if(this.atEnd)throw new s.ME(c.A6,(0,u.D)(e,t,this.lineno,this.colno));const r=this.next();if("|"===r)break;n+=r}while(!this.atEnd)}else n+=r}return n}parenMatches(e,t){switch(e){case"(":return")"===t;case"[":return"]"===t;case"{":return"}"===t;default:return!1}}eatSpace(){if(this.atEnd)return[];const e=this.peek();if(e.match(/\s/)){for(;this.peek().match(/\s/);)this.next();return this.eatSpace()}if(";"===e||"#"===e&&this.peek(3).match(/^#![ /]$/)){for(;!this.atEnd&&"\n"!=this.peek();)this.next();return"\n"===this.peek()&&this.next(),this.eatSpace()}if("#"===e&&this.match("#|")){const e=this.lineno,t=this.colno-2;let n=1;for(;!this.atEnd&&n>0;){const e=this.next();"#"===e&&this.match("|")?n++:"|"===e&&this.match("#")&&n--}if(this.atEnd&&n>0)throw new s.ME(c.mS,(0,u.D)(e,t,this.lineno,this.colno));return this.eatSpace()}return"#"===e&&this.match("#;")?[(0,u.D)(this.lineno,this.colno-2,this.lineno,this.colno)].concat(this.eatSpace()):[]}next(){const e=this.input[this.position++];return this.checkAtEnd(),"\n"===e?(this.lineno++,this.colno=0):""!==e&&this.colno++,e}peek(e=1){return this.input.slice(this.position,Math.min(this.position+e,this.input.length))}match(e){if(this.peek(e.length)===e){for(let t=0;t<e.length;t++)this.next();return!0}return!1}checkAtEnd(){this.position==this.input.length&&(this.atEnd=!0)}}var B=n(789),D=n(794);class R{constructor(e,t){this.defns=e,this.nodes=t}}function q(e){return(0,o.F)(e)?e.token.text:`(${e.subSExprs.map((e=>q(e))).join(" ")})`}class _{constructor(){this.global=new i.x,this.inFunDef=!1}run(e){this.inFunDef=!1;try{return(0,s.mf)(this.processSExprs(e.output))}catch(e){if(e instanceof s.ME)return(0,s.mf)(null,[e]);throw e}}processSExprs(e){const t=[],n=[];for(const s of e){const e=this.toNode(s);((0,B.Mf)(e)||(0,B.O0)(e))&&t.push(e),n.push(e)}return new R(t,n)}toNode(e){if((0,o.F)(e))switch(e.token.type){case l.i.True:return new B.RD(D.Xp,e.sourceSpan);case l.i.False:return new B.RD(D.Tg,e.sourceSpan);case l.i.Integer:return new B.RD(new D.pv(BigInt(e.token.text.replace(".",""))),e.sourceSpan);case l.i.Rational:{const t=e.token.text.split("/");return new B.RD(new D.pv(BigInt(t[0]),BigInt(t[1])),e.sourceSpan)}case l.i.Decimal:{const[t,n]=e.token.text.split("."),s=10n**BigInt(n.length),r=BigInt(t);return r<0?new B.RD(new D.pv(r*s-BigInt(n),s),e.sourceSpan):new B.RD(new D.pv(r*s+BigInt(n),s),e.sourceSpan)}case l.i.Character:{let t=e.token.text.slice(2);switch(t){case"nul":case"null":t=String.fromCharCode(0);break;case"backspace":t=String.fromCharCode(8);break;case"tab":t=String.fromCharCode(9);break;case"newline":case"linefeed":t=String.fromCharCode(10);break;case"vtab":t=String.fromCharCode(11);break;case"page":t=String.fromCharCode(12);break;case"return":t=String.fromCharCode(13);break;case"space":t=String.fromCharCode(32);break;case"rubout":t=String.fromCharCode(127)}return new B.RD(new D.Ym(t),e.sourceSpan)}case l.i.String:return new B.RD(new D.tm(e.token.text.slice(1,-1)),e.sourceSpan);case l.i.Name:return new B.fY(e.token.text,e.sourceSpan);case l.i.Keyword:if(e.token.text===h.Z.Else)throw new s.ME(c._m,e.sourceSpan);throw new s.ME((0,c.te)(e.token.text),e.sourceSpan);case l.i.Placeholder:return new B.bK(e,e.sourceSpan);default:throw"illegal state: unhandled token type"}else{const t=e.subSExprs[0];if(!t)throw new s.ME((0,c.y5)(),e.sourceSpan);if((0,o.MW)(t)){if(p.L.higherOrderFunctions)return new B.xf(this.toNode(t),e.subSExprs.slice(1).map((e=>this.toNode(e))),e.sourceSpan);throw new s.ME((0,c.y5)(t),t.sourceSpan)}switch(t.token.type){case l.i.Name:return new B.xf(this.toNode(t),e.subSExprs.slice(1).map((e=>this.toNode(e))),e.sourceSpan);case l.i.Placeholder:return new B.PM(t,e.sourceSpan);case l.i.Keyword:switch(t.token.text){case h.Z.And:return this.toAndNode(e);case h.Z.CheckError:case h.Z.CheckExpect:case h.Z.CheckMemberOf:case h.Z.CheckRandom:case h.Z.CheckRange:case h.Z.CheckSatisfied:case h.Z.CheckWithin:return this.toCheckNode(t.token.text,e);case h.Z.Cond:return this.toCondNode(e);case h.Z.Define:return this.toDefnNode(e);case h.Z.DefineStruct:return this.toDefnStructNode(e);case h.Z.Else:throw new s.ME(c._m,t.sourceSpan);case h.Z.If:return this.toIfNode(e);case h.Z.Lambda:return this.toLambdaNode(e);case h.Z.Letrec:case h.Z.Letstar:case h.Z.Let:return this.toLetNode(t.token.text,e);case h.Z.Local:return this.toLocalNode(e);case h.Z.Or:return this.toOrNode(e);case h.Z.Quasiquote:return this.toQuasiquoteNode(e,e.subSExprs[1]);case h.Z.Quote:return this.toQuoteNode(e,e.subSExprs[1]);case h.Z.Unquote:throw new s.ME((0,c.R9)("unquote","comma"),t.sourceSpan);case h.Z.Require:return this.toRequireNode(e);default:throw"illegal state: unhandled keyword"}default:throw new s.ME((0,c.y5)(t),t.sourceSpan)}}}toAndNode(e){if(e.subSExprs.length-1<2)throw new s.ME((0,c.a1)(h.Z.And,2,e.subSExprs.length-1),e.subSExprs[0].sourceSpan);return new B.Ov(e.subSExprs.slice(1).map((e=>this.toNode(e))),e.sourceSpan)}toCheckNode(e,t){const n=this.global.primitiveTestFunctions.get(e);if(n.arity&&t.subSExprs.length-1!==n.arity)throw new s.ME((0,c.WY)(e,n.arity,t.subSExprs.length-1),t.sourceSpan);if(n.minArity&&t.subSExprs.length-1<n.minArity)throw new s.ME((0,c.a1)(e,n.minArity,t.subSExprs.length-1),t.sourceSpan);if(n.maxArity&&t.subSExprs.length-1>n.maxArity)throw new s.ME((0,c.WY)(e,n.maxArity,t.subSExprs.length-1),t.sourceSpan);switch(e){case h.Z.CheckError:return new B.c$(t.subSExprs.slice(1).map((e=>this.toNode(e))),t.sourceSpan);case h.Z.CheckMemberOf:return new B.rx(this.toNode((0,o.Rp)([(0,o.Xy)(new l.W(l.i.Name,"member",t.sourceSpan),t.sourceSpan),t.subSExprs[1],(0,o.Rp)([(0,o.Xy)(new l.W(l.i.Name,"list",t.sourceSpan),t.sourceSpan),...t.subSExprs.slice(2)],t.sourceSpan)],t.sourceSpan)),this.toNode(t.subSExprs[1]),t.subSExprs.slice(2).map((e=>this.toNode(e))),t.sourceSpan);case h.Z.CheckRange:{const e=t.subSExprs[1],n=t.subSExprs[2],s=t.subSExprs[3];return new B.Us(this.toNode((0,o.Rp)([(0,o.Xy)(new l.W(l.i.Keyword,h.Z.And,t.sourceSpan),t.sourceSpan),(0,o.Rp)([(0,o.Xy)(new l.W(l.i.Name,"<=",t.sourceSpan),t.sourceSpan),n,e],t.sourceSpan),(0,o.Rp)([(0,o.Xy)(new l.W(l.i.Name,"<=",t.sourceSpan),t.sourceSpan),e,s],t.sourceSpan)],t.sourceSpan)),this.toNode(e),this.toNode(n),this.toNode(s),t.sourceSpan)}case h.Z.CheckSatisfied:return new B.p8(this.toNode((0,o.Rp)([t.subSExprs[2],t.subSExprs[1]],t.sourceSpan)),this.toNode(t.subSExprs[1]),this.toNode(t.subSExprs[2]),q(t.subSExprs[2]),t.sourceSpan);case h.Z.CheckWithin:return new B.Et(this.toNode((0,o.Rp)([(0,o.Xy)(new l.W(l.i.Name,"equal~?",t.sourceSpan),t.sourceSpan),t.subSExprs[1],t.subSExprs[2],t.subSExprs[3]],t.sourceSpan)),this.toNode(t.subSExprs[1]),this.toNode(t.subSExprs[2]),this.toNode(t.subSExprs[3]),t.sourceSpan);default:return new B.Up(e,t.subSExprs.slice(1).map((e=>this.toNode(e))),t.sourceSpan)}}toCondNode(e){if(e.subSExprs.length-1==0)throw new s.ME((0,c.He)(),e.sourceSpan);const t=[];for(const[n,r]of e.subSExprs.slice(1).entries()){if(!(0,o.MW)(r)||2!==r.subSExprs.length)throw new s.ME((0,c.He)(r),r.sourceSpan);const i=r.subSExprs[0];if((0,o.F)(i)&&i.token.type===l.i.Keyword&&i.token.text===h.Z.Else){if(n<e.subSExprs.length-2)throw new s.ME(c.C0,r.sourceSpan);t.push([new B.RD(D.Xp,i.sourceSpan),this.toNode(r.subSExprs[1])])}else t.push([this.toNode(i),this.toNode(r.subSExprs[1])])}return new B.r_(t,e.sourceSpan)}toDefnNode(e){if(e.subSExprs.length-1==0)throw new s.ME((0,c.d)(),e.sourceSpan);let t=e.subSExprs[1];if((0,o.F)(t)){if(t.token.type!==l.i.Name)throw new s.ME((0,c.d)(t),t.sourceSpan);if(e.subSExprs.length-1==1)throw new s.ME((0,c.ll)(t.token.text),e.sourceSpan);if(e.subSExprs.length-1>2)throw new s.ME((0,c.fN)(t.token.text,e.subSExprs.length-3),e.subSExprs[3].sourceSpan);this.inFunDef=!0;const n=this.toNode(e.subSExprs[2]);(0,B.xX)(n)&&(n.name=t.token.text);const r=new B.ho(t.token.text,t.sourceSpan,n,e.sourceSpan);return this.inFunDef=!1,r}{const n=t;if(0===n.subSExprs.length)throw new s.ME((0,c.ON)(),e.sourceSpan);if(t=n.subSExprs[0],!(0,o.F)(t)||t.token.type!==l.i.Name)throw new s.ME((0,c.ON)(t),e.sourceSpan);if(n.subSExprs.length-1==0)throw new s.ME(c.JY,n.sourceSpan);const r=[];for(const e of n.subSExprs.slice(1)){if(!(0,o.F)(e)||e.token.type!==l.i.Name)throw new s.ME((0,c.Ax)(e),e.sourceSpan);if(r.includes(e.token.text))throw new s.ME((0,c.$Z)(e.token.text),e.sourceSpan);r.push(e.token.text)}if(e.subSExprs.length-1==1)throw new s.ME(c.yQ,e.sourceSpan);if(e.subSExprs.length-1>2)throw new s.ME((0,c.Mi)(e.subSExprs.length-3),e.subSExprs[3].sourceSpan);return new B.ho(t.token.text,t.sourceSpan,new B.kt(t.token.text,r,this.toNode(e.subSExprs[2]),e.subSExprs[2].sourceSpan),e.sourceSpan)}}toDefnStructNode(e){if(e.subSExprs.length-1==0)throw new s.ME((0,c.AC)(),e.sourceSpan);const t=e.subSExprs[1];if(!(0,o.F)(t)||t.token.type!==l.i.Name)throw new s.ME((0,c.AC)(t),t.sourceSpan);if(e.subSExprs.length-1==1)throw new s.ME((0,c.bU)(),e.sourceSpan);const n=e.subSExprs[2];if(!(0,o.MW)(n))throw new s.ME((0,c.bU)(n),n.sourceSpan);const r=[];for(const e of n.subSExprs){if(!(0,o.F)(e)||e.token.type!==l.i.Name&&e.token.type!==l.i.Keyword)throw new s.ME((0,c.eJ)(e),e.sourceSpan);if(r.includes(e.token.text))throw new s.ME((0,c.Kl)(e.token.text),e.sourceSpan);r.push(e.token.text)}if(e.subSExprs.length-1>2)throw new s.ME((0,c.YT)(e.subSExprs.length-3),e.subSExprs[3].sourceSpan);return new B.pW(t.token.text,t.sourceSpan,r,e.sourceSpan)}toIfNode(e){if(e.subSExprs.length-1!=3)throw new s.ME((0,c.tw)(e.subSExprs.length-1),e.sourceSpan);return new B.yq(this.toNode(e.subSExprs[1]),this.toNode(e.subSExprs[2]),this.toNode(e.subSExprs[3]),e.sourceSpan)}toLambdaNode(e){if(!p.L.higherOrderFunctions||!p.L.syntax.lambdaExpression&&!this.inFunDef)throw new s.ME(c.sH,e.sourceSpan);if(e.subSExprs.length-1==0)throw new s.ME((0,c.Gl)(),e.sourceSpan);const t=e.subSExprs[1];if((0,o.F)(t))throw new s.ME((0,c.Gl)(t),t.sourceSpan);if(0===t.subSExprs.length)throw new s.ME(c.QF,t.sourceSpan);const n=[];for(const e of t.subSExprs){if((0,o.MW)(e)||e.token.type!==l.i.Name)throw new s.ME((0,c.Ci)(e),e.sourceSpan);if(n.includes(e.token.text))throw new s.ME((0,c.SY)(e.token.text),e.sourceSpan);n.push(e.token.text)}if(e.subSExprs.length-1!=2)throw new s.ME((0,c.s5)(e.subSExprs.length-1),e.sourceSpan);return new B.kt(null,n,this.toNode(e.subSExprs[2]),e.sourceSpan)}toLetNode(e,t){if(t.subSExprs.length-1==0)throw new s.ME((0,c.hp)(e),t.sourceSpan);const n=t.subSExprs[1];if((0,o.F)(n))throw new s.ME((0,c.hp)(e,n),n.sourceSpan);const r=[];for(const t of n.subSExprs){if((0,o.F)(t)||0===t.subSExprs.length)throw new s.ME((0,c.QM)(e,t),t.sourceSpan);const n=this.toNode(t.subSExprs[0]);if(!(0,B.Gg)(n))throw new s.ME((0,c.hd)(e,t.subSExprs[0]),n.sourceSpan);if(1===t.subSExprs.length)throw new s.ME((0,c.Qb)(e,n.name),t.sourceSpan);if(t.subSExprs.length>2)throw new s.ME((0,c.zO)(e,n.name,t.subSExprs.length-2),t.subSExprs[2].sourceSpan);r.push([n,this.toNode(t.subSExprs[1])])}if(t.subSExprs.length-1==1)throw new s.ME((0,c.SE)(e),t.sourceSpan);if(t.subSExprs.length-1>2)throw new s.ME((0,c.gn)(e,t.subSExprs.length-3),t.subSExprs[3].sourceSpan);return new B.p7(e,r,this.toNode(t.subSExprs[2]),t.sourceSpan)}toLocalNode(e){if(e.subSExprs.length-1==0)throw new s.ME((0,c.OP)(),e.sourceSpan);const t=e.subSExprs[1];if((0,o.F)(t))throw new s.ME((0,c.OP)(t),t.sourceSpan);const n=[];for(const e of t.subSExprs){const t=this.toNode(e);if(!(0,B.Mf)(t))throw new s.ME((0,c.Eh)(e),t.sourceSpan);n.push(t)}if(e.subSExprs.length-1==1)throw new s.ME(c.zs,e.sourceSpan);if(e.subSExprs.length-1>2)throw new s.ME((0,c.jf)(e.subSExprs.length-3),e.subSExprs[3].sourceSpan);return new B.PJ(n,this.toNode(e.subSExprs[2]),e.sourceSpan)}toOrNode(e){if(e.subSExprs.length-1<2)throw new s.ME((0,c.a1)(h.Z.Or,2,e.subSExprs.length-1),e.subSExprs[0].sourceSpan);return new B.O1(e.subSExprs.slice(1).map((e=>this.toNode(e))),e.sourceSpan)}toQuasiquoteNode(e,t){if(e.subSExprs.length-1==0)throw new s.ME(c.Lf,e.sourceSpan);if(e.subSExprs.length-1>1)throw new s.ME((0,c._M)(e.subSExprs.length-2),e.subSExprs[2].sourceSpan);if((0,o.F)(t)){if(t.token.type===l.i.Name||t.token.type===l.i.Keyword||t.token.type===l.i.Placeholder)return new B.RD(new D.iN(t.token.text),t.sourceSpan);if(p.L.syntax.listAbbreviation)return this.toNode(t);throw new s.ME((0,c.xL)(t),e.sourceSpan)}if(0===t.subSExprs.length)return new B.RD(D.K8,e.sourceSpan);if(!p.L.syntax.listAbbreviation)throw new s.ME((0,c.xL)(t),e.sourceSpan);if((0,o.F)(t.subSExprs[0])&&t.subSExprs[0].token.type===l.i.Keyword&&"unquote"===t.subSExprs[0].token.text){if(t.subSExprs.length-1!=1)throw new s.ME((0,c.NJ)("unquote"),t.subSExprs[0].sourceSpan);return this.toNode(t.subSExprs[1])}return new B.xf(new B.fY("list",e.sourceSpan),t.subSExprs.map((t=>this.toQuasiquoteNode(e,t))),e.sourceSpan)}toQuoteNode(e,t){if(e.subSExprs.length-1==0)throw new s.ME(c.Lf,e.sourceSpan);if(e.subSExprs.length-1>1)throw new s.ME((0,c._M)(e.subSExprs.length-2),e.subSExprs[2].sourceSpan);if((0,o.F)(t)){if(t.token.type===l.i.Name||t.token.type===l.i.Keyword||t.token.type===l.i.Placeholder)return new B.RD(new D.iN(t.token.text),t.sourceSpan);if(p.L.syntax.listAbbreviation)return this.toNode(t);throw new s.ME((0,c.xL)(t),e.sourceSpan)}if(0===t.subSExprs.length)return new B.RD(D.K8,e.sourceSpan);if(!p.L.syntax.listAbbreviation)throw new s.ME((0,c.xL)(t),e.sourceSpan);return new B.xf(new B.fY("list",e.sourceSpan),t.subSExprs.map((t=>this.toQuoteNode(e,t))),e.sourceSpan)}toRequireNode(e){if(e.subSExprs.length-1!=1||!(0,o.F)(e.subSExprs[1])||e.subSExprs[1].token.type!==l.i.Name)throw new s.ME((0,c.p7)(e.subSExprs.length-1,e.subSExprs[1]),e.subSExprs.length-1==1?e.subSExprs[1].sourceSpan:e.sourceSpan);return new B.s5(e.subSExprs[1].token.text,e.subSExprs[1].sourceSpan,e.sourceSpan)}}var L=n(819);class H{constructor(e){this.unusedCallback=e}run(e){for(const t of e.output.nodes)t.accept(this);return(0,s.mf)(void 0)}visitAndNode(e){e.used?e.args.forEach((e=>e.accept(this))):e.isTemplate()||this.unusedCallback(e.sourceSpan)}visitAtomNode(e){e.used||this.unusedCallback(e.sourceSpan)}visitCheckNode(e){e.used||this.unusedCallback(e.sourceSpan)}visitCondNode(e){e.used?e.questionAnswerClauses.forEach((e=>{e[0].accept(this),e[1].accept(this)})):e.isTemplate()||this.unusedCallback(e.sourceSpan)}visitDefnVarNode(e){e.used?e.value.accept(this):e.isTemplate()||this.unusedCallback(e.sourceSpan)}visitDefnStructNode(e){}visitEllipsisProcAppNode(e){}visitEllipsisNode(e){}visitIfNode(e){e.used?(e.question.accept(this),e.trueAnswer.accept(this),e.falseAnswer.accept(this)):e.isTemplate()||this.unusedCallback(e.sourceSpan)}visitLambdaNode(e){e.used?e.body.accept(this):e.isTemplate()||this.unusedCallback(e.sourceSpan)}visitLetNode(e){e.used?(e.bindings.forEach((([e,t])=>{e.accept(this),t.accept(this)})),e.body.accept(this)):e.isTemplate()||this.unusedCallback(e.sourceSpan)}visitLocalNode(e){e.used?(e.defns.forEach((e=>e.accept(this))),e.body.accept(this)):e.isTemplate()||this.unusedCallback(e.sourceSpan)}visitOrNode(e){e.used?e.args.forEach((e=>e.accept(this))):e.isTemplate()||this.unusedCallback(e.sourceSpan)}visitProcAppNode(e){e.used?e.args.forEach((e=>e.accept(this))):e.isTemplate()||this.unusedCallback(e.sourceSpan)}visitRequireNode(e){e.used||this.unusedCallback(e.sourceSpan)}visitVarNode(e){e.used||this.unusedCallback(e.sourceSpan)}}var W=n(484);class Z{constructor(){this.level=0,this.scope=new W.s}reset(){this.scope=new W.s}run(e){try{return this.assertWellFormedProgram(e.output),e}catch(e){if(e instanceof s.ME)return(0,s.mf)(null,[e]);throw e}}visitAndNode(e){this.incrementLevel(),e.args.forEach((e=>e.accept(this)))}visitAtomNode(e){}visitCheckNode(e){if(!this.atTopLevel())throw new s.ME((0,c.z3)(e.name),e.sourceSpan);this.incrementLevel(),e.args.forEach((e=>e.accept(this)))}visitCondNode(e){this.incrementLevel(),e.questionAnswerClauses.forEach((([e,t])=>{e.accept(this),t.accept(this)}))}visitDefnVarNode(e){if(!this.atTopLevel())throw new s.ME((0,c.u)(h.Z.Define),e.sourceSpan);this.incrementLevel(),e.value.accept(this)}visitDefnStructNode(e){if(!this.atTopLevel())throw new s.ME((0,c.u)(h.Z.DefineStruct),e.sourceSpan)}visitEllipsisProcAppNode(e){}visitEllipsisNode(e){}visitIfNode(e){this.incrementLevel(),e.question.accept(this),e.trueAnswer.accept(this),e.falseAnswer.accept(this)}visitLambdaNode(e){this.incrementLevel();const t=this.scope;this.scope=new W.s(this.scope),e.params.forEach((e=>this.scope.set(e,W.x.Data))),e.body.accept(this),this.scope=t}visitLetNode(e){this.incrementLevel();const t=new Set,n=new W.s(this.scope),r=this.scope;switch(e.name){case"letrec":e.bindings.forEach((([e,r])=>{if(t.has(e.name))throw new s.ME((0,c.Gb)(e.name),e.sourceSpan);t.add(e.name),n.set(e.name,W.x.Data)})),this.scope=n,e.bindings.forEach((([e,t])=>t.accept(this)));break;case"let*":this.scope=n,e.bindings.forEach((([e,r])=>{if(t.has(e.name))throw new s.ME((0,c.Gb)(e.name),e.sourceSpan);t.add(e.name),n.set(e.name,W.x.Data),r.accept(this)}));break;case"let":e.bindings.forEach((([e,r])=>{if(t.has(e.name))throw new s.ME((0,c.Gb)(e.name),e.sourceSpan);t.add(e.name),n.set(e.name,W.x.Data)})),e.bindings.forEach((([e,t])=>t.accept(this))),this.scope=n;break;default:throw"illegal state: unsupported let-style expression"}e.body.accept(this),this.scope=r}visitLocalNode(e){const t=new Set,n=new W.s(this.scope);e.defns.forEach((e=>{if(t.has(e.name))throw new s.ME((0,c.Gb)(e.name),e.nameSourceSpan);t.add(e.name),e.addToScope(n,!0)}));const r=this.scope;this.scope=n,e.defns.forEach((e=>{this.resetLevel(),e.accept(this)})),this.incrementLevel(),e.body.accept(this),this.scope=r}visitOrNode(e){this.incrementLevel(),e.args.forEach((e=>e.accept(this)))}visitProcAppNode(e){this.incrementLevel(),e.fn.accept(this),e.args.forEach((e=>e.accept(this)))}visitRequireNode(e){if(!this.atTopLevel())throw new s.ME(c.uC,e.sourceSpan)}visitVarNode(e){const t=this.scope.get(e.name,!0,e.sourceSpan);if(!p.L.higherOrderFunctions&&t===W.x.StructureType)throw new s.ME((0,c.ss)(e.name),e.sourceSpan);if(!p.L.higherOrderFunctions&&t!==W.x.Data)throw new s.ME((0,c.n3)(e.name),e.sourceSpan);if(!this.scope.has(e.name))throw new s.ME((0,c.In)(e.name),e.sourceSpan)}assertWellFormedProgram(e){this.addDefinitionsToScope(e.defns),e.nodes.forEach((e=>{this.resetLevel(),e.accept(this)}))}addDefinitionsToScope(e){for(const t of e)t.addToScope(this.scope)}resetLevel(){this.level=0}incrementLevel(){this.level++}atTopLevel(){return 0===this.level}}class I{constructor(){this.LEXING_STAGE=new F,this.PARSING_SEXPRS_STAGE=new _,this.WELL_FORMED_PROGRAM_STAGE=new Z,this.GENERATE_LABELS_STAGE=new a,this.EVALUATE_CODE_STAGE=new r.K,this.UNUSED_CODE_STAGE=new H((()=>{})),this.errorsCallback=()=>{},this.successCallback=()=>{},this.testResultsCallback=()=>{},this.unusedCallback=()=>{},this.reformatCallback=()=>{}}evaluateCode(e){try{this.evaluateCodeHelper(e)}catch(e){if(!(e instanceof I.ShortCircuitPipeline))throw e}}reformatCode(e){this.reformatCallback(e)}reset(){L.i.reset(),this.WELL_FORMED_PROGRAM_STAGE.reset(),this.EVALUATE_CODE_STAGE.reset()}setErrorsCallback(e){this.errorsCallback=e}setSuccessCallback(e){this.successCallback=e}setTestResultsCallback(e){this.testResultsCallback=e}setUnusedCallback(e){this.unusedCallback=e,this.UNUSED_CODE_STAGE=new H(this.unusedCallback)}setReformatCallback(e){this.reformatCallback=e}evaluateCodeHelper(e){const t=(0,s.mf)(e),n=this.LEXING_STAGE.run(t);this.handleErrors(n,null);const r=this.PARSING_SEXPRS_STAGE.run(n);this.handleErrors(r,r);const i=this.WELL_FORMED_PROGRAM_STAGE.run(r);this.handleErrors(i,r),this.GENERATE_LABELS_STAGE.run(i);const a=this.EVALUATE_CODE_STAGE.run(i);this.handleErrors(a,r,!0),this.successCallback(a.output),this.testResultsCallback(a.tests),this.UNUSED_CODE_STAGE.run(r)}handleErrors(e,t,n=!1){if(e.errors.length>0)throw this.errorsCallback(e.errors),this.testResultsCallback(e.tests),n&&t&&this.UNUSED_CODE_STAGE.run(t),new I.ShortCircuitPipeline(e)}}I.ShortCircuitPipeline=class extends Error{constructor(e){super(),this.StageResult=e}},window.racket={updateSettings:e=>(0,p.V)(e),pipeline:new I}},159:(e,t,n)=>{n.d(t,{q2:()=>r,ko:()=>i,Et:()=>a,gc:()=>o,oM:()=>c,$w:()=>u,Nf:()=>l,TT:()=>h});var s=n(794);const r=2,i=r/2,a="white",o=2*Math.PI;function c(e,t){const n=document.createElement("canvas");return n.width=e,n.height=t,[n,n.getContext("2d")]}function u(e,t){let n=(0,s.cU)(t)?Number(t.numerator)/255:1;return(0,s.Vd)(e)?(n*=Number(e.vals[3].numerator)/255,`rgba(${e.vals[0].stringify()}, ${e.vals[1].stringify()}, ${e.vals[2].stringify()}, ${n})`):`rgba(${p.get(e.val).join(", ")}, ${n})`}function l(e){return!(0,s.cU)(e)&&"outline"===e.val}function h(e){return p.has(e.val.toLowerCase())}const p=new Map([["aliceblue",[240,248,255]],["antiquewhite",[250,235,215]],["aqua",[0,255,255]],["azure",[240,255,255]],["beige",[245,245,220]],["bisque",[255,228,196]],["blanchedalmond",[255,235,205]],["blueviolet",[138,43,226]],["burlywood",[222,184,135]],["cadetblue",[95,158,160]],["chartreuse",[127,255,0]],["chocolate",[210,105,30]],["cornflowerblue",[100,149,237]],["cornsilk",[255,248,220]],["crimson",[220,20,60]],["darkblue",[0,0,139]],["darkcyan",[0,139,139]],["darkgoldenrod",[184,134,11]],["darkgray",[169,169,169]],["darkgreen",[0,100,0]],["darkkhaki",[189,183,107]],["darkmagenta",[139,0,139]],["darkolivegreen",[85,107,47]],["darkorange",[255,140,0]],["darkorchid",[153,50,204]],["darkred",[139,0,0]],["darksalmon",[233,150,122]],["darkseagreen",[143,188,139]],["darkslateblue",[72,61,139]],["darkslategray",[47,79,79]],["darkturquoise",[0,206,209]],["darkviolet",[148,0,211]],["deeppink",[255,20,147]],["deepskyblue",[0,191,255]],["dimgray",[105,105,105]],["dodgerblue",[30,144,255]],["floralwhite",[255,250,240]],["forestgreen",[34,139,34]],["fuchsia",[255,0,255]],["gainsboro",[220,220,220]],["ghostwhite",[248,248,255]],["greenyellow",[173,255,47]],["honeydew",[240,255,240]],["hotpink",[255,105,180]],["indianred",[205,92,92]],["indigo",[75,0,130]],["ivory",[255,255,240]],["lavender",[230,230,250]],["lavenderblush",[255,240,245]],["lawngreen",[124,252,0]],["lemonchiffon",[255,250,205]],["lightblue",[173,216,230]],["lightcoral",[240,128,128]],["lightcyan",[224,255,255]],["lightgoldenrodyellow",[250,250,210]],["lightgreen",[144,238,144]],["lightgray",[211,211,211]],["lightpink",[255,182,193]],["lightsalmon",[255,160,122]],["lightseagreen",[32,178,170]],["lightskyblue",[135,206,250]],["lightslategray",[119,136,153]],["lightsteelblue",[176,196,222]],["lightyellow",[255,255,224]],["lime",[0,255,0]],["limegreen",[50,205,50]],["linen",[250,240,230]],["mediumaquamarine",[102,205,170]],["mediumblue",[0,0,205]],["mediumorchid",[186,85,211]],["mediumpurple",[147,112,219]],["mediumseagreen",[60,179,113]],["mediumslateblue",[123,104,238]],["mediumspringgreen",[0,250,154]],["mediumturquoise",[72,209,204]],["mediumvioletred",[199,21,133]],["midnightblue",[25,25,112]],["mintcream",[245,255,250]],["mistyrose",[255,228,225]],["moccasin",[255,228,181]],["navajowhite",[255,222,173]],["oldlace",[253,245,230]],["olive",[128,128,0]],["olivedrab",[107,142,35]],["orangered",[255,69,0]],["palegoldenrod",[238,232,170]],["palegreen",[152,251,152]],["paleturquoise",[175,238,238]],["palevioletred",[219,112,147]],["papayawhip",[255,239,213]],["peachpuff",[255,218,185]],["peru",[205,133,63]],["powderblue",[176,224,230]],["rosybrown",[188,143,143]],["royalblue",[65,105,225]],["saddlebrown",[139,69,19]],["sandybrown",[244,164,96]],["seagreen",[46,139,87]],["seashell",[255,245,238]],["silver",[192,192,192]],["skyblue",[135,206,235]],["slateblue",[106,90,205]],["slategray",[112,128,144]],["snow",[255,250,250]],["springgreen",[0,255,127]],["steelblue",[70,130,180]],["teal",[0,128,128]],["tomato",[255,99,71]],["whitesmoke",[245,245,245]],["yellowgreen",[154,205,50]],["aquamarine",[112,216,144]],["black",[0,0,0]],["blue",[0,0,255]],["blue violet",[138,43,226]],["brown",[132,60,36]],["cadet blue",[96,160,160]],["coral",[255,127,80]],["cornflower blue",[68,64,108]],["cyan",[0,255,255]],["dark gray",[169,169,169]],["dark green",[0,100,0]],["dark olive green",[85,107,47]],["dark orchid",[153,50,204]],["dark slate blue",[72,61,139]],["dark slate gray",[47,79,79]],["dark turquoise",[0,206,209]],["dim gray",[105,105,105]],["firebrick",[178,34,34]],["forest green",[34,139,34]],["gold",[255,215,0]],["goldenrod",[218,165,32]],["gray",[190,190,190]],["green",[0,255,0]],["green yellow",[173,255,47]],["indian red",[205,92,92]],["khaki",[240,230,140]],["light blue",[173,216,230]],["light gray",[211,211,211]],["light steel blue",[176,196,222]],["lime green",[50,205,50]],["magenta",[255,0,255]],["maroon",[176,48,96]],["medium aquamarine",[102,205,170]],["medium blue",[0,0,205]],["medium forest green",[107,142,35]],["mediumforestgreen",[107,142,35]],["medium goldenrod",[234,234,173]],["mediumgoldenrod",[234,234,173]],["medium orchid",[186,85,211]],["medium sea green",[60,179,113]],["medium slate blue",[123,104,238]],["medium spring green",[0,250,154]],["medium turquoise",[72,209,204]],["medium violet red",[199,21,133]],["midnight blue",[25,25,112]],["navy",[36,36,140]],["orange",[255,165,0]],["orange red",[255,69,0]],["orchid",[218,112,214]],["pale green",[152,251,152]],["pink",[255,192,203]],["plum",[221,160,221]],["purple",[160,32,240]],["red",[255,0,0]],["salmon",[250,128,114]],["sea green",[46,139,87]],["sienna",[160,82,45]],["sky blue",[135,206,235]],["slate blue",[106,90,205]],["spring green",[0,255,127]],["steel blue",[70,130,180]],["tan",[210,180,140]],["thistle",[216,191,216]],["turquoise",[64,224,208]],["violet",[238,130,238]],["violet red",[208,32,144]],["violetred",[208,32,144]],["wheat",[245,222,179]],["white",[255,255,255]],["yellow",[255,255,0]],["yellow green",[154,205,50]]])},830:(e,t,n)=>{n.d(t,{yC:()=>i,re:()=>a,lB:()=>o,gf:()=>c});var s=n(794),r=n(239);class i extends s.PM{constructor(e){super(),this.canvas=e}stringify(){return"#image"}getType(){return new r.__}equalWithin(e){if(!c(e)||e.canvas.width!==this.canvas.width||e.canvas.height!==this.canvas.height)return!1;const t=this.canvas.getContext("2d").getImageData(0,0,this.canvas.width,this.canvas.height).data,n=e.canvas.getContext("2d").getImageData(0,0,e.canvas.width,e.canvas.height).data;return t.every(((e,t)=>e===n[t]))}}function a(e){return e instanceof i&&0===e.canvas.width&&0===e.canvas.height}function o(e){return(0,s.cU)(e)&&1n===e.denominator&&e.numerator>=0n&&e.numerator<256n}function c(e){return e instanceof i}},239:(e,t,n)=>{n.d(t,{Mr:()=>c,e6:()=>u,__:()=>l,XG:()=>h});var s=n(794),r=n(432),i=n(359),a=n(830),o=n(159);class c extends i.Dy{stringify(){return"image-color"}isCompatibleWith(e,t,n){if((0,s.$e)(e)||(0,s.re)(e)){if((0,o.TT)(e))return!0;throw new r.ME(((e,t)=>`${e}: ${t} is not a valid color name`)(t,e.stringify()),n)}return!!((0,s.Vd)(e)&&"color"===e.name&&4===e.vals.length&&(0,a.lB)(e.vals[0])&&(0,a.lB)(e.vals[1])&&(0,a.lB)(e.vals[2])&&(0,a.lB)(e.vals[2]))}isSuperTypeOfHelper(e){return e instanceof c}}class u extends i.Dy{stringify(){return"integer between 0 and 255"}isSuperTypeOfHelper(e,t){return e instanceof u||(0,s.cU)(t)&&1n===t.denominator&&t.numerator>=0&&t.numerator<256}}class l extends i.Dy{isSuperTypeOfHelper(e){return e instanceof l}stringify(){return"image"}}class h extends i.Dy{constructor(){super([new u],[new s.tm("solid"),new s.iN("solid"),new s.tm("outline"),new s.iN("outline")])}stringify(){return"mode"}}},96:(e,t,n)=>{n.d(t,{K:()=>d,u:()=>w});var s=n(789),r=n(34),i=n(226),a=n(794),o=n(432),c=n(223),u=n(625),l=n(819),h=n(870),p=n(246);class d{constructor(){this.env=new c.q,this.globalEnv=new c.q,this.execEnv=new c.q,this.testResults=[]}reset(){this.globalEnv=new c.q,this.execEnv=new c.q}run(e){this.testResults=[];const t=e.output;this.env=this.globalEnv;try{t.defns.forEach((e=>{e.accept(this),(0,s.Mf)(e)&&(e.used=!1)}));const e=[];for(const n of t.nodes){let t;(0,s.HF)(n)?(this.env=this.globalEnv,t=n.accept(this)):(this.env=this.execEnv,t=n.accept(this)),t instanceof a.pm?this.testResults.push((0,o.ty)(t.passed,t.msg,t.sourceSpan)):t!==a.dZ&&e.push(t)}return(0,o.mf)(e,[],this.testResults)}catch(e){if(e instanceof o.ME)return(0,o.mf)([],[e],this.testResults);if(e instanceof Error&&"too much recursion"===e.message)return(0,o.mf)([],[new o.ME(r.nT,i.B)],this.testResults);throw e}}visitAndNode(e){e.used=!0;let t=a.Tg;for(const n of e.args)if(t=n.accept(this),(0,a.h8)(t))return t;if(!(0,a.JI)(t))throw new o.ME((0,r.hC)(u.Z.And,t.stringify()),e.sourceSpan);return t}visitAtomNode(e){return e.used=!0,e.rval}visitCheckNode(e){switch(e.used=!0,e.name){case u.Z.CheckExpect:case u.Z.CheckRandom:{let t,n;if(e.name===u.Z.CheckExpect)t=e.args[0].accept(this),n=e.args[1].accept(this);else{const s=(new Date).toString()+(new Date).getMilliseconds();l.i.reset(s),t=e.args[0].accept(this),l.i.reset(s),n=e.args[1].accept(this)}if((0,a.up)(t)||(0,a.up)(n))throw new o.ME((0,r.Iy)(e.name),e.sourceSpan);if((0,a.gX)(t)||(0,a.gX)(n))throw new o.ME((0,r.Cq)(e.name,t.stringify(),n.stringify()),e.sourceSpan);return(0,a.oh)(t)&&t.equal(n)?new a.pm(!0):new a.pm(!1,(0,r.l)(t.stringify(),n.stringify()),e.sourceSpan)}default:throw"illegal state: non-implemented test function"}}visitCheckErrorNode(e){e.used=!0;let t=null;if(e.args[1]&&(t=e.args[1].accept(this),!(0,a.$e)(t)))throw new o.ME((0,r.XM)(t.stringify()),e.args[1].sourceSpan);try{return new a.pm(!1,(0,r.KW)(e.args[0].accept(this).stringify()),e.sourceSpan)}catch(n){if(n instanceof o.ME)return t&&t.val!==n.msg?new a.pm(!1,(0,r.gD)(t.val,n.msg),e.sourceSpan):new a.pm(!0);throw n}}visitCheckMemberOfNode(e){e.used=!0;const t=e.arg.accept(this);return(0,a.h8)(t)?new a.pm(!1,(0,r.bB)(e.testValNode.accept(this).stringify(),e.testAgainstValNodes.map((e=>e.accept(this).stringify()))),e.sourceSpan):new a.pm(!0)}visitCheckRangeNode(e){e.used=!0;const t=e.arg.accept(this);return(0,a.h8)(t)?new a.pm(!1,(0,r.yG)(e.testValNode.accept(this).stringify(),e.lowerBoundValNode.accept(this).stringify(),e.upperBoundValNode.accept(this).stringify()),e.sourceSpan):new a.pm(!0)}visitCheckSatisfiedNode(e){e.used=!0;const t=e.arg.accept(this);return(0,a.JI)(t)?(0,a.h8)(t)?new a.pm(!1,(0,r.R0)(e.testFnName,e.testValNode.accept(this).stringify()),e.sourceSpan):new a.pm(!0):new a.pm(!1,(0,r.$h)(e.testFnName,t.stringify()),e.sourceSpan)}visitCheckWithinNode(e){return e.used=!0,(0,a.h8)(e.arg.accept(this))?new a.pm(!1,(0,r.v_)(e.actualNode.accept(this).stringify(),e.expectedNode.accept(this).stringify(),e.withinNode.accept(this).stringify()),e.sourceSpan):new a.pm(!0)}visitCondNode(e){e.used=!0;for(const[t,n]of e.questionAnswerClauses){const s=t.accept(this);if(!(0,a.JI)(s))throw new o.ME((0,r.hC)(u.Z.Cond,s.stringify()),e.sourceSpan);if(s===a.Xp)return n.accept(this)}throw new o.ME(r.NS,e.sourceSpan)}visitDefnStructNode(e){return e.used=!0,this.env.set(e.name,new a.Bb(e.name)),this.env.set(`make-${e.name}`,new a.Y2(e.name,e.fields.length)),this.env.set(`${e.name}?`,new a.Vq(e.name)),e.fields.forEach(((t,n)=>{this.env.set(`${e.name}-${t}`,new a.If(e.name,t,n))})),a.dZ}visitDefnVarNode(e){return e.used=!0,this.env.set(e.name,e.value.accept(this)),a.dZ}visitEllipsisProcAppNode(e){throw new o.ME((0,r.XK)(e.placeholder.token.text),e.sourceSpan)}visitEllipsisNode(e){throw new o.ME((0,r.XK)(e.placeholder.token.text),e.sourceSpan)}visitIfNode(e){e.used=!0;const t=e.question.accept(this);if(!(0,a.JI)(t))throw new o.ME((0,r.hC)(u.Z.If,t.stringify()),e.sourceSpan);return(0,a.Zb)(t)?e.trueAnswer.accept(this):e.falseAnswer.accept(this)}visitLambdaNode(e){return e.used=!0,new a.bS(e.name,this.env.copy(),e.params,e.body)}visitLetNode(e){switch(e.used=!0,e.bindings.forEach((([e,t])=>{e.used=!0})),e.name){case"letrec":case"let*":case"let":{const t=this.env;this.env=new c.q(this.env),e.bindings.forEach((([e,t])=>{this.env.set(e.name,t.accept(this))}));const n=e.body.accept(this);return this.env=t,n}default:throw"illegal state: unsupported let-style expression"}}visitLocalNode(e){e.used=!0;const t=this.env;this.env=new c.q(this.env),e.defns.forEach((e=>e.accept(this)));const n=e.body.accept(this);return this.env=t,n}visitOrNode(e){e.used=!0;let t=a.Xp;for(const n of e.args)if(t=n.accept(this),t!==a.Tg)break;if(!(0,a.JI)(t))throw new o.ME((0,r.hC)(u.Z.Or,t.stringify()),e.sourceSpan);return t}visitProcAppNode(e){let t;if(e.used=!0,(0,s.Gg)(e.fn)){if(t=this.env.get(e.fn.name,e.fn.sourceSpan),!(0,a.up)(t))throw new o.ME((0,r.y5)((0,a.gB)(t)?`a structure type (do you mean make-${t.name})`:"a variable"),e.fn.sourceSpan)}else t=e.fn.accept(this);if(!(0,a.up)(t))throw new o.ME((0,r.y5)((0,a.gB)(t)?`a structure type (do you mean make-${t.name})`:t.stringify()),e.fn.sourceSpan);try{return t.accept(new w(e.args,this.env,e.sourceSpan))}catch(t){throw t instanceof p.gK?new o.ME(t.message,e.sourceSpan):t}}visitRequireNode(e){e.used=!0;const t=e.global.modules.get(e.name);for(const e of t.procedures)this.env.has(e.getName())||this.env.set(e.getName(),e);for(const[e,n]of t.data)this.env.has(e)||this.env.set(e,n);return a.dZ}visitVarNode(e){return e.used=!0,this.env.get(e.name,e.sourceSpan)}}class w{constructor(e,t,n){this.args=e,this.env=t,this.sourceSpan=n,this.evaluator=new d,this.evaluator.env=t}visitRComposedProcedure(e){let t=e.procedures[0].accept(this);for(const n of e.procedures.slice(1))t=n.accept(new w([new s.RD(t,this.sourceSpan)],this.env,this.sourceSpan));return t}visitRStructHuhProc(e){if(1!==this.args.length)throw new o.ME((0,r.WY)(`${e.name}?`,1,this.args.length),this.sourceSpan);const t=this.args[0].accept(this.evaluator);return t instanceof a.$z&&t.name===e.name?a.Xp:a.Tg}visitRMakeStructFun(e){if(e.arity!==this.args.length)throw new o.ME((0,r.WY)(`make-${e.name}`,e.arity,this.args.length),this.sourceSpan);return new a.$z(e.name,this.args.map((e=>e.accept(this.evaluator))))}visitRLambda(e){const t=new c.q;for(let n=0;n<this.args.length;n++)t.set(e.params[n],this.args[n].accept(this.evaluator));const n=e.closure.copy();n.parentEnv=this.env,t.parentEnv=n;const s=this.evaluator.env;this.evaluator.env=t;const r=e.body.accept(this.evaluator);return this.evaluator.env=s,r}visitRPrimProc(e){const t=this.args.length;if(void 0!==e.config.minArityWithoutLists){if(t<=e.config.minArityWithoutLists)throw new o.ME((0,r.Pd)(e.name),this.sourceSpan)}else if(h.L.primitives.relaxedConditions.includes(e.name)&&void 0!==e.config.relaxedMinArity){if(t<e.config.relaxedMinArity)throw new o.ME((0,r.a1)(e.name,e.config.relaxedMinArity,t),this.sourceSpan)}else if(e.config.minArity&&t<e.config.minArity)throw new o.ME((0,r.a1)(e.name,e.config.minArity,t),this.sourceSpan);const n=e.getType(this.args.length);if(t!==n.paramTypes.length)throw new o.ME((0,r.WY)(e.name,n.paramTypes.length,t),this.sourceSpan);const s=this.args.map((e=>e.accept(this.evaluator)));for(const[t,i]of n.paramTypes.entries()){const a=s[t];if(!i.isCompatibleWith(a,e.name,this.sourceSpan))throw 1===n.paramTypes.length?new o.ME((0,r.R5)(e.name,i.stringify(),a.stringify()),this.sourceSpan):new o.ME((0,r.F6)(e.name,i.stringify(),t,a.stringify()),this.sourceSpan)}return e.call(s,this.sourceSpan,this.env)}visitRStructGetProc(e){if(1!==this.args.length)throw new o.ME((0,r.WY)(`${e.name}-${e.fieldName}`,1,this.args.length),this.sourceSpan);const t=this.args[0].accept(this.evaluator);if(!(t instanceof a.$z)||t.name!=e.name)throw new o.ME((0,r.R5)(`${e.name}-${e.fieldName}`,e.name,t.stringify()),this.sourceSpan);return t.vals[e.idx]}}},246:(e,t,n)=>{n.d(t,{Fk:()=>o,yv:()=>a,DA:()=>c,OO:()=>u,_r:()=>l,a_:()=>h,h8:()=>p,b7:()=>d,KY:()=>w,JM:()=>m,gK:()=>i});var s=n(359),r=n(794);class i extends Error{}const a=new r.Rg;class o extends r.em{constructor(){super("=~")}getType(){return new s.B5([new s.sw,new s.sw,new s.Y5],new s.wy)}call(e){return(0,r.K_)(e[0].equalWithin(e[1],e[2].toDecimal()))}}class c extends r.em{constructor(){super("eof-object?")}getType(){return new s.B5([new s.Hs],new s.wy)}call(e){return(0,r.K_)((0,r.HI)(e[0]))}}class u extends r.em{constructor(){super("eq?")}getType(){return new s.B5([new s.Hs,new s.Hs],new s.wy)}call(e){return(0,r.K_)((0,r.oh)(e[0])&&e[0].eq(e[1]))}}class l extends r.em{constructor(){super("equal?")}getType(){return new s.B5([new s.Hs,new s.Hs],new s.wy)}call(e){return(0,r.K_)((0,r.oh)(e[0])&&e[0].equal(e[1]))}}class h extends r.em{constructor(){super("equal~?")}getType(){return new s.B5([new s.Hs,new s.Hs,new s.Y5],new s.wy)}call(e){const t=e[2].toDecimal();return(0,r.K_)((0,r.oh)(e[0])&&e[0].equalWithin(e[1],t))}}class p extends r.em{constructor(){super("eqv?")}getType(){return new s.B5([new s.Hs,new s.Hs],new s.wy)}call(e){return(0,r.K_)((0,r.oh)(e[0])&&e[0].eqv(e[1]))}}class d extends r.em{constructor(){super("error",{})}getType(e){return new s.B5(new Array(e).fill(new s.Hs),new s.NI)}call(e){let t="";for(const n of e)(0,r.$e)(n)?t+=n.val:(0,r.re)(n)?t+=`${n}: `:t+=n.stringify();throw new i(t)}}class w extends r.em{constructor(){super("identity")}getType(){return new s.B5([new s.Hs],new s.Hs)}call(e){return e[0]}}class m extends r.em{constructor(){super("struct?")}getType(){return new s.B5([new s.Hs],new s.wy)}call(e){return(0,r.K_)((0,r.Vd)(e[0]))}}},819:(e,t,n)=>{function s(e){let t=1779033703^e.length;for(let n=0;n<e.length;n++)t=Math.imul(t^e.charCodeAt(n),3432918353),t=t<<13|t>>>19;return()=>(t=Math.imul(t^t>>>16,2246822507),t=Math.imul(t^t>>>13,3266489909),(t^=t>>>16)>>>0)}function r(e){return()=>{let t=e+=1831565813;return t=Math.imul(t^t>>>15,1|t),t^=t+Math.imul(t^t>>>7,61|t),((t^t>>>14)>>>0)/4294967296}}n.d(t,{i:()=>i});const i=new class{constructor(){this.seed=s((new Date).toString()),this.rng=r(this.seed())}reset(e=this.rng().toString()){this.seed=s(e),this.rng=r(this.seed())}next(){return this.rng()}}},870:(e,t,n)=>{n.d(t,{L:()=>a,V:()=>i});var s=n(625),r=n(1);function i(e={}){o(a,e),a.syntax.forms=a.syntax.forms.filter((e=>s.j.includes(e))),a.higherOrderFunctions?(new r.x).enableHigherOrderFunctions():(new r.x).disableHigherOrderFunctions()}const a={higherOrderFunctions:!1,primitives:{blackList:[],relaxedConditions:[]},stringify:{abbreviatedList:!1},syntax:{forms:[...s.j],lambdaExpression:!1,listAbbreviation:!1,quasiquoting:!1}};function o(e,...t){if(!t.length)return e;const n=t.shift();if(c(e)&&c(n))for(const t in n)c(n[t])?(e[t]||Object.assign(e,{[t]:{}}),o(e[t],n[t])):Object.assign(e,{[t]:n[t]});o(e,...t)}function c(e){return e&&"object"==typeof e&&!Array.isArray(e)}},794:(e,t,n)=>{n.d(t,{K8:()=>Y,Tg:()=>V,Xp:()=>z,dZ:()=>X,es:()=>h,Ym:()=>p,BC:()=>T,PM:()=>u,Rg:()=>d,pv:()=>y,Af:()=>x,Vq:()=>k,bS:()=>C,zG:()=>E,Y2:()=>N,em:()=>A,tm:()=>w,$z:()=>S,If:()=>$,Bb:()=>m,iN:()=>f,pm:()=>c,JI:()=>M,up:()=>P,oh:()=>F,HI:()=>B,bm:()=>D,cU:()=>R,h8:()=>q,gX:()=>_,Oz:()=>L,Dw:()=>H,LF:()=>W,$e:()=>Z,Vd:()=>I,gB:()=>O,re:()=>K,Zb:()=>U,K_:()=>G});var s=n(359),r=n(226),i=n(870);function a(e,t){return t?a(t,e%t):e}class o{equal(e){return!1}}class c extends o{constructor(e,t="",n=r.B){super(),this.passed=e,this.msg=t,this.sourceSpan=n}stringify(){throw"illegal state: cannot stringify a test result"}getType(){throw"illegal state: should not be asking type of test result"}}class u extends o{equal(e){return this.equalWithin(e,0)}eqv(e){return this.equal(e)}eq(e){return e===this}}class l extends u{}class h extends l{constructor(e){super(),this.val=e}stringify(){return this.val?"#true":"#false"}getType(){return new s.wy}equalWithin(e,t){return M(e)&&e.val===this.val}}class p extends l{constructor(e){super(),this.val=e}stringify(){switch(this.val){case p.NULL_CHAR:return"#\\null";case p.BACKSPACE_CHAR:return"#\\backspace";case p.TAB_CHAR:return"#\\tab";case p.NEWLINE_CHAR:return"#\\newline";case p.VTAB_CHAR:return"#\\vtab";case p.PAGE_CHAR:return"#\\page";case p.RETURN_CHAR:return"#\\return";case p.SPACE_CHAR:return"#\\space";case p.RUBOUT_CHAR:return"#\\rubout"}return`#\\${this.val}`}getType(){return new s.sr}equalWithin(e,t){return function(e){return e instanceof p}(e)&&e.val===this.val}}p.NULL_CHAR=String.fromCharCode(0),p.BACKSPACE_CHAR=String.fromCharCode(8),p.TAB_CHAR=String.fromCharCode(9),p.NEWLINE_CHAR=String.fromCharCode(10),p.VTAB_CHAR=String.fromCharCode(11),p.PAGE_CHAR=String.fromCharCode(12),p.RETURN_CHAR=String.fromCharCode(13),p.SPACE_CHAR=String.fromCharCode(32),p.RUBOUT_CHAR=String.fromCharCode(127);class d extends l{stringify(){return"#<eof>"}getType(){return new s.hJ}equalWithin(e,t){return B(e)}}class w extends l{constructor(e){super(),this.val=e,this.ESCAPED_A=String.fromCharCode(7),this.ESCAPED_B=String.fromCharCode(8),this.ESCAPED_T=String.fromCharCode(9),this.ESCAPED_N=String.fromCharCode(10),this.ESCAPED_V=String.fromCharCode(11),this.ESCAPED_F=String.fromCharCode(12),this.ESCAPED_R=String.fromCharCode(13),this.ESCAPED_E=String.fromCharCode(27)}stringify(){let e="";for(const t of this.val)switch(t){case this.ESCAPED_A:e+="\\a";break;case this.ESCAPED_B:e+="\\b";break;case this.ESCAPED_T:e+="\\t";break;case this.ESCAPED_N:e+="\\n";break;case this.ESCAPED_V:e+="\\v";break;case this.ESCAPED_F:e+="\\f";break;case this.ESCAPED_R:e+="\\r";break;case this.ESCAPED_E:e+="\\e";break;case'"':e+='\\"';break;case"\\":e+="\\\\";break;default:e+=t}return`"${e}"`}getType(){return new s.uW}equalWithin(e,t){return Z(e)&&e.val===this.val}}class m extends l{constructor(e){super(),this.name=e}stringify(){return this.name}getType(){return new s.B7(this.name)}equalWithin(e,t){return O(e)&&e.name===this.name}}class f extends l{constructor(e){super(),this.val=e}stringify(){return this.val.includes("\n")?`'|${this.val}|`:"'"+this.val}getType(){return new s.Ko}equalWithin(e,t){return K(e)&&e.val===this.val}}class g extends l{stringify(){return"(void)"}getType(){return new s.hJ}equalWithin(e,t){return function(e){return e instanceof g}(e)}}class v extends l{constructor(e,t=1n){if(super(),this.numerator=e,this.denominator=t,e<0&&t<0||e>0&&t>0){const n=a(e,t);this.numerator=e/n,this.denominator=t/n}else{const n=a(-1n*e,t);this.numerator=e/n,this.denominator=t/n}}stringify(){if(1n===this.denominator)return this.numerator.toString();if(this.isNegative()){const e=this.numerator/this.denominator;return`${e}${(Number(this.numerator-e*this.denominator)/Number(this.denominator)).toString().slice(2)}`}{const e=this.numerator/this.denominator;return`${e}${(Number(this.numerator-e*this.denominator)/Number(this.denominator)).toString().slice(1)}`}}equalWithin(e,t){return W(e)&&this.within(e,t)}within(e,t){return Math.abs(this.toDecimal()-e.toDecimal())<=t}isPositive(){return this.numerator>0}isZero(){return 0n===this.numerator}isNegative(){return this.numerator<0}toDecimal(){const e=this.numerator/this.denominator;return Number(e)+Number(this.numerator-e*this.denominator)/Number(this.denominator)}}class y extends v{getType(){return 1n===this.denominator?this.numerator>0?new s.NL:0n===this.numerator?new s.D9:new s.Fc:this.numerator>=0?new s.Y5:new s.hZ}equal(e){return R(e)&&e.numerator===this.numerator&&e.denominator===this.denominator}negate(){return new y(-1n*this.numerator,this.denominator)}}class x extends v{stringify(){return`#i${super.stringify()}`}getType(){return 0n===this.denominator?new s.Fc:new s.Ee}equal(e){return W(e)&&e.numerator===this.numerator&&e.denominator===this.denominator}negate(){return new x(-1n*this.numerator,this.denominator)}}class E extends u{constructor(e){super(),this.vals=e}stringify(){if(0===this.vals.length)return"'()";if(i.L.stringify.abbreviatedList)return`(list ${this.vals.map((e=>e.stringify())).join(" ")})`;{let e=`(cons ${this.vals[0].stringify()}`;for(const t of this.vals.slice(1))e+=` (cons ${t.stringify()}`;return e+=" '()"+")".repeat(this.vals.length),e}}getType(){return new s.RH(this.vals.length)}equalWithin(e,t){return H(e)&&e.vals.length===this.vals.length&&e.vals.every(((e,n)=>{const s=this.vals[n];return F(e)&&F(s)&&e.equalWithin(s,t)}))}eqv(e){return e===this}}class S extends u{constructor(e,t){super(),this.name=e,this.vals=t}stringify(){return 0===this.vals.length?`(make-${this.name})`:`(make-${this.name} ${this.vals.map((e=>e.stringify())).join(" ")})`}getType(){return new s.JQ(this.name)}equalWithin(e,t){return I(e)&&e.name===this.name&&e.vals.every(((e,n)=>{const s=this.vals[n];return F(e)&&F(s)&&e.equalWithin(s,t)}))}eqv(e){return e===this}}class b extends o{constructor(e={}){super(),this.config=e}getName(){return"#<procedure>"}}class T extends b{constructor(...e){super(),this.procedures=e}accept(e){return e.visitRComposedProcedure(this)}stringify(){const e=this.procedures[0];return e.config.minArity||e.config.minArityWithoutLists?"(lambda args ...)":`(lambda (${e.getType(-1).paramTypes.map(((e,t)=>`a${t+1}`))}) ...)`}getType(e){return new s.B5(this.procedures[0].getType(e).paramTypes,new s.Hs)}}class k extends b{constructor(e){super(),this.name=e}accept(e){return e.visitRStructHuhProc(this)}stringify(){return this.name}getType(){return new s.B5([new s.Hs],new s.wy)}getName(){return`${this.name}?`}}class N extends b{constructor(e,t){super(),this.name=e,this.arity=t}accept(e){return e.visitRMakeStructFun(this)}stringify(){return this.name}getType(){return new s.B5(new Array(this.arity).fill(new s.Hs),new s.JQ(this.name))}getName(){return`make-${this.name}`}}class C extends b{constructor(e,t,n,s){super(),this.name=e,this.closure=t,this.params=n,this.body=s}accept(e){return e.visitRLambda(this)}stringify(){return this.name?this.name:`(lambda (${this.params.map(((e,t)=>`a${t+1}`)).join(" ")}) ...)`}getType(){return new s.B5(new Array(this.params.length).fill(new s.Hs),new s.Hs)}}class A extends b{constructor(e,t={}){super(),this.name=e,this.config=t}accept(e){return e.visitRPrimProc(this)}stringify(){return this.name}call(e,t,n){throw"illegal state: not implemented"}getName(){return this.name}}class $ extends b{constructor(e,t,n){super(),this.name=e,this.fieldName=t,this.idx=n}accept(e){return e.visitRStructGetProc(this)}stringify(){return`${this.name}-${this.fieldName}`}getType(){return new s.B5([new s.JQ(this.name)],new s.Hs)}getName(){return`${this.name}-${this.fieldName}`}}function M(e){return e instanceof h}function P(e){return e instanceof b}function F(e){return e instanceof u}function B(e){return e instanceof d}function D(e){return H(e)&&0===e.vals.length}function R(e){return e instanceof y}function q(e){return M(e)&&!e.val}function _(e){return e instanceof x}function L(e){return W(e)&&1n===e.denominator}function H(e){return e instanceof E}function W(e){return e instanceof v}function Z(e){return e instanceof w}function I(e){return e instanceof S}function O(e){return e instanceof m}function K(e){return e instanceof f}function U(e){return M(e)&&e.val}function G(e){return e?z:V}const X=new g,z=new h(!0),V=new h(!1),Y=new E([])},359:(e,t,n)=>{n.d(t,{wj:()=>a,Hs:()=>i,wy:()=>o,sr:()=>c,NI:()=>u,D9:()=>l,NL:()=>h,Fc:()=>p,RH:()=>d,Y5:()=>w,sw:()=>m,hE:()=>f,FJ:()=>g,B5:()=>v,Ee:()=>y,hZ:()=>x,uW:()=>E,JQ:()=>S,B7:()=>b,Ko:()=>T,Dy:()=>r,hJ:()=>k,xW:()=>N});var s=n(794);class r{constructor(e=[],t=[]){this.children=e,this.literals=t}isCompatibleWith(e,t,n){return this.isSuperTypeOf(e.getType(-1),e)}isSuperTypeOf(e,t){return e instanceof this.constructor||this.children.some((n=>n.isSuperTypeOf(e,t)))||this.literals.some((e=>e.equal(t)))}}class i extends r{stringify(){return"any/c"}isCompatibleWith(){return!0}isSuperTypeOf(){return!0}}class a extends r{stringify(){return"procedure"}isCompatibleWith(e){return(0,s.up)(e)}isSuperTypeOf(e){return e instanceof a||e instanceof v}}class o extends r{stringify(){return"boolean"}}class c extends r{stringify(){return"character"}}class u extends r{stringify(){return"error"}}class l extends r{constructor(){super([new h])}stringify(){return"exact-non-negative-integer"}}class h extends r{stringify(){return"exact-positive-integer"}}class p extends r{constructor(){super([new l])}stringify(){return"integer"}}class d extends r{constructor(e=0){super(),this.minLength=e}stringify(){return 0===this.minLength?"list":1===this.minLength?"non-empty list":`list with ${this.minLength} or more elements`}isSuperTypeOf(e){return e instanceof d&&e.minLength>=this.minLength||0===this.minLength&&e instanceof g}}class w extends r{constructor(){super([new l])}stringify(){return"non-negative-real"}}class m extends r{constructor(){super([new x])}stringify(){return"number"}}class f extends r{constructor(e,t){super(e,t)}stringify(){return`(or/c ${this.children.map((e=>e.stringify())).join(" ")})`}}class g extends r{isSuperTypeOf(e){return e instanceof g||e instanceof d}stringify(){return"pair"}}class v extends r{constructor(e,t){super(),this.paramTypes=e,this.outputType=t}isSuperTypeOf(e,t){return e instanceof v&&e.paramTypes.length===this.paramTypes.length&&this.paramTypes.every(((n,s)=>n.isSuperTypeOf(e.paramTypes[s],t)))&&this.outputType.isSuperTypeOf(e.outputType,t)}isCompatibleWith(e){if(!(0,s.up)(e))return!1;const t=e.getType(this.paramTypes.length);return t.paramTypes.length===this.paramTypes.length&&this.paramTypes.every(((n,s)=>n.isSuperTypeOf(t.paramTypes[s],e)||t.paramTypes[s].isSuperTypeOf(n,e)))&&(this.outputType.isSuperTypeOf(t.outputType,e)||t.outputType.isSuperTypeOf(this.outputType,e))}stringify(){return`(${this.paramTypes.map((e=>e.stringify())).join(" ")} . -> . ${this.outputType.stringify()})`}}class y extends r{constructor(){super([new p])}stringify(){return"rational"}}class x extends r{constructor(){super([new w,new y])}stringify(){return"real"}}class E extends r{stringify(){return"string"}}class S extends r{constructor(e){super(),this.name=e}stringify(){return"illegal state: should not have to stringify a structure type"}isSuperTypeOf(e){return e instanceof S&&e.name===this.name}}class b extends r{constructor(e){super(),this.name=e}stringify(){return this.name}isSuperTypeOf(e){return e instanceof b&&e.name===this.name}}class T extends r{stringify(){return"string"}}class k extends r{stringify(){return"void"}}function N(e){return e instanceof v}}},e=>{e(e.s=751)}]);